<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.3.450" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="dcterms.date" content="2024-01-15" />

<title>70BiomColl_AdvDataVisR – Tutorial: Advanced data visualization in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- set all external hyperlinks to open in a new window (i.e. target="_blank" ) -->
<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    const currentHostname = window.location.hostname;

    document.querySelectorAll('a').forEach(function(link) {
      // Check if the link is external
      if (link.hostname !== currentHostname) {
        link.setAttribute('target', '_blank');
      }
    });
  });
</script>


<link rel="stylesheet" href="styles.css" />
</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="/index.html">
    <span class="navbar-title">Tutorial: Advanced data visualization in R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
  aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"
  onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://schmidtpaul.github.io/" rel="" target="">
 <span class="menu-text">Contact</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/SchmidtPaul/70BiomColl_AdvDataVisR" rel="" target=""><i 
  class="bi bi-github" 
  role="img" 
  aria-label="GitHub" 
>
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial: Advanced data visualization in R</h1>
<p class="subtitle lead">70th Biometrical Colloquium 2024 in Luebeck</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Paul Schmidt </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.biomath.de/">
            BioMath GmbH
            </a>
          </p>
        <p class="affiliation">
            <a href="https://schmidtpaul.github.io/">
            &amp; Freelancer
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Last updated</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 15, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-0-setup" id="toc-part-0-setup">Part 0: Setup</a></li>
  <li><a href="#part-1-export" id="toc-part-1-export">Part 1: Export</a>
  <ul>
  <li><a href="#export-and-open-file" id="toc-export-and-open-file">Export and open file</a></li>
  <li><a href="#use-camcorder" id="toc-use-camcorder">Use {camcorder}</a></li>
  </ul></li>
  <li><a href="#part-2-a-single-plot" id="toc-part-2-a-single-plot">Part 2: A single plot</a>
  <ul>
  <li><a href="#data-prep" id="toc-data-prep">data prep</a></li>
  <li><a href="#base-plot" id="toc-base-plot">base plot</a>
  <ul>
  <li><a href="#factor-level-reordering" id="toc-factor-level-reordering">(factor) level reordering</a></li>
  </ul></li>
  <li><a href="#reproducing-a-theme" id="toc-reproducing-a-theme">reproducing a theme</a>
  <ul>
  <li><a href="#font" id="toc-font">font</a></li>
  <li><a href="#axes" id="toc-axes">axes</a></li>
  <li><a href="#legend" id="toc-legend">legend</a></li>
  <li><a href="#grid-lines" id="toc-grid-lines">grid lines</a></li>
  </ul></li>
  <li><a href="#improve-the-plot" id="toc-improve-the-plot">improve the plot</a>
  <ul>
  <li><a href="#labels" id="toc-labels">labels</a></li>
  <li><a href="#remove-legend" id="toc-remove-legend">remove legend</a></li>
  <li><a href="#dumbbell-plot" id="toc-dumbbell-plot">dumbbell plot</a></li>
  <li><a href="#labels-again" id="toc-labels-again">labels again</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#part-3-multiple-plots" id="toc-part-3-multiple-plots">Part 3: Multiple plots</a>
  <ul>
  <li><a href="#data-prep-1" id="toc-data-prep-1">data prep</a></li>
  <li><a href="#facets" id="toc-facets">facets</a></li>
  <li><a href="#individual-labels" id="toc-individual-labels">individual labels</a></li>
  <li><a href="#individual-scales" id="toc-individual-scales">individual scales</a></li>
  </ul></li>
  <li><a href="#todo" id="toc-todo">TODO</a></li>
  </ul>
</nav>
<p>This is the supporting material for the tutorial <strong>Advanced data visualization in R</strong> which is part of the 70th Biometrical Colloquium 2024 in Luebeck and takes place 28.02.2024 09:00-12:00. Here is the tutorial description as displayed on the <a href="https://www.biometrische-gesellschaft.de/en/events/biometric-colloquia/70th-biometrical-colloquium-2024-in-luebeck/conference-program.html">website’s conference program</a>:</p>
<blockquote>
<p><strong>Advanced data visualization in R: (Re)producing professional plots with ggplot2 and the tidyverse</strong></p>
<p>Lecturer: Paul Schmidt (BioMath GmbH, Hamburg)</p>
<p>Learning objectives:</p>
<ul>
<li>Deep dive into ggplot2: Understand the intricacies of ggplot2 for top-tier data visualization</li>
<li>Data manipulation with tidyverse: Utilize packages like dplyr, tidyr, and forcats to shape data optimally for creating graphs</li>
<li>Aesthetic fine-tuning: Master the skills of axis formatting, theme detailing, and color selection</li>
<li>Reproducing Exercise: Recreate published plots to understand the application of ggplot2 techniques in real-world scenarios</li>
<li>Exporting excellence: Learn best practices for exporting plots in publication-ready formats</li>
</ul>
<p>Target group:</p>
<ul>
<li>Anyone wanting to produce or present high-quality plots. Conveying complex data insights through refined visualizations is a relevant part of statistical analysis</li>
</ul>
<p>Prerequisites:</p>
<ul>
<li>Basic understanding of R programming is required</li>
<li>Basic knowledge of ggplot2 and the tidyverse is beneficial, but not required</li>
<li>R-packages: tidyverse, cowplot, ggrepel, ggtext, viridis</li>
</ul>
<p>Format: Hybrid</p>
</blockquote>
<section id="part-0-setup" class="level1">
<h1>Part 0: Setup</h1>
<p>Notice that we expect participants with different levels of experience in this tutorial. Furthermore, the tutorial duration is only 3 hours and thus quite short. As a consequence, this material often links to other resources with more detailed information instead of blowing up the content of this material. However, where possible, these links don’t simply lead to official online documentation etc. which may be hard to grasp for beginners, but instead to other workshop content created by this tutorial’s main lecturer.</p>
<p>The decision on which plots to create in this workshop was inspired by <a href="https://albert-rapp.de/posts/ggplot2-tips/15_alternative_paired_bars/15_alternative_paired_bars.html">this blog post</a> by <a href="https://albert-rapp.de/">Albert Rapp</a> whose R and data visualization content is worth checking out!</p>
<p>You will need to install and load the following packages</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;camcorder&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;cowplot&quot;)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;gapminder&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggh4x&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;ggrepel&quot;)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggtext&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;scales&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;showtext&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;viridis&quot;)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(camcorder)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(cowplot)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggh4x)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggrepel)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># library(viridis)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>showtext<span class="sc">::</span><span class="fu">showtext_opts</span>(<span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
</section>
<section id="part-1-export" class="level1">
<h1>Part 1: Export</h1>
<p>This might be a bit unexpected, but I would argue that the very first thing we should talk about is exporting your ggplots. A major reason for this is the fact that by default you would create your ggplots by looking at them in the “Plots” preview window in RStudio. While this is not a problem <em>per se</em>, it becomes problematic once you realize the scale/size of your ggplot automatically adjusts to the size of your preview window. This is especially annoying regarding font sizes. Try it out: Create the following ggplot and then play around with width and height of your “Plots” panel in RStudio:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>myplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> mtcars) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> mpg, <span class="at">x =</span> hp) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
</div>
<p>You may get results like this:</p>
<div class="columns">
<div class="column" style="width:49%;">
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>myplot</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</div><div class="column" style="width:2%;">

</div><div class="column" style="width:49%;">
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>myplot</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</div>
</div>
<p>As far as I know, there are two ways of properly dealing with this.</p>
<section id="export-and-open-file" class="level2">
<h2>Export and open file</h2>
<p>To avoid the issue, you may simply never look at the preview of your ggplot in RStudio and instead always export your plot to then look at the exported file. Exporting a ggplot is flexible and convenient. You can choose a device function (e.g. <a href="https://www.rdocumentation.org/packages/grDevices/versions/3.4.1/topics/png">png</a>) or “eps”, “ps”, “tex” (pictex), “pdf”, “jpeg”, “tiff”, “png”, “bmp”, “svg” or “wmf” (windows only). Furthermore, you can set width and height in a unit of your choice and depending on your file type even choose the dpi and more.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;myfile.png&quot;</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> myplot,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">6</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>) </span></code></pre></div>
</div>
<p>You don’t even need to manually open the file after creating it if you instead run this:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&#39;open &quot;myfile.png&quot;&#39;</span>)</span></code></pre></div>
</div>
</section>
<section id="use-camcorder" class="level2">
<h2>Use {camcorder}</h2>
<p>There is a package called <a href="https://thebioengineer.github.io/camcorder/"><code>{camcorder}</code></a> which advertises its “eventual goal of creating a GIF showing all the plots saved sequentially during the design process” like in <a href="https://thebioengineer.github.io/camcorder/#goal-end-product">these examples</a>. However, I am <a href="https://albert-rapp.de/posts/ggplot2-tips/12_a_few_gg_packages/12_a_few_gg_packages.html#camcorder">not the only one</a> using camcorder for its feature of fixing the canvas size. In other words: It shows your ggplot in the RStudio panel fixed to your chosen scale. Thus, simply run something like this at the beginning of your session so that all ggplots shown afterwards are exactly 6x4 inches wide with dpi 300:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>  camcorder<span class="sc">::</span><span class="fu">gg_record</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">6</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<p>Note that it actually does not show up in RStudio’s “Plots” but in its “Viewer” panel. Furthermore, note that it actually saves the intermediate plots somewhere, but defaults to a temporary directory for that.</p>
</section>
</section>
<section id="part-2-a-single-plot" class="level1">
<h1>Part 2: A single plot</h1>
<p>Let us first create a single plot to compare the life expectancy between 1952 and 2007 for seven countries, respectively.</p>
<section id="data-prep" class="level2">
<h2>data prep</h2>
<p>The data is courtesy of <a href="https://www.gapminder.org/">the Gapminder foundation</a> and can easily be accessed via the <a href="https://jennybc.github.io/gapminder/">{gapminder}</a> package. We can then make use of <a href="https://schmidtpaul.github.io/dsfair_quarto/ch/rbasics/tidyverse.html#the-pipe-operator">the pipe operator <code>%&gt;%</code></a> to create a subset of the data via the <a href="https://schmidtpaul.github.io/dsfair_quarto/ch/rbasics/tidyverse.html#filter"><code>filter()</code> function</a>. Then, in order for our ggplot to work as intended in the next step, we also need to format the year column as a factor instead of an integer value via <a href="https://schmidtpaul.github.io/dsfair_quarto/ch/rbasics/tidyverse.html#mutate"><code>mutate()</code></a>. Both functions are from the <a href="https://dplyr.tidyverse.org/">{dplyr}</a> package which we loaded as part of the <a href="https://www.tidyverse.org/">{tidyverse}</a>. Finally, we use <code>droplevels()</code> to get rid of the factor levels that are now no longer present in the data (i.e. the countries we did not filter for).</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> gapminder<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1952</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Netherlands&quot;</span>, <span class="st">&quot;Nigeria&quot;</span>, <span class="st">&quot;Vietnam&quot;</span>, <span class="st">&quot;Zimbabwe&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14 × 6</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    country     continent year  lifeExp       pop gdpPercap</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Canada      Americas  1952     68.8  14785584    11367.</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Canada      Americas  2007     80.7  33390141    36319.</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Germany     Europe    1952     67.5  69145952     7144.</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Germany     Europe    2007     79.4  82400996    32170.</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Japan       Asia      1952     63.0  86459025     3217.</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Japan       Asia      2007     82.6 127467972    31656.</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Netherlands Europe    1952     72.1  10381988     8942.</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Netherlands Europe    2007     79.8  16570613    36798.</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Nigeria     Africa    1952     36.3  33119096     1077.</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Nigeria     Africa    2007     46.9 135031164     2014.</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 Vietnam     Asia      1952     40.4  26246839      605.</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 Vietnam     Asia      2007     74.2  85262356     2442.</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13 Zimbabwe    Africa    1952     48.5   3080907      407.</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 Zimbabwe    Africa    2007     43.5  12311143      470.</span></span></code></pre></div>
</div>
</section>
<section id="base-plot" class="level2">
<h2>base plot</h2>
<p>One typical way you may find data like this visualized is via a grouped bar plot. The minimum amount of code to create such a plot via ggplot is this:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>())</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
<p><a href="https://schmidtpaul.github.io/dsfair_quarto/ch/summaryarticles/ggplot2intro.html#lets-start">Read this</a> if you are not familiar with the general ggplot syntax. We need to add <code>position = position_dodge()</code> to <code>geom_col()</code>, since the default is to stack the multiple bars (for the different years) on top of each other (as seen in the <em>Nature</em> example plot below).</p>
<section id="factor-level-reordering" class="level3">
<h3>(factor) level reordering</h3>
<p>It may seem irritating that countries are sorted alphabetically starting at the bottom. Moreover, 1952 is below 2007 in the plot (but not in the legend!). This is because these two columns are formatted as factors in our data and by default factor levels are sorted alphabetically.</p>
<p>Note that ggplot applies this factor level order, but does it so from bottom to top.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dat<span class="sc">$</span>country)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Canada&quot;      &quot;Germany&quot;     &quot;Japan&quot;       &quot;Netherlands&quot; &quot;Nigeria&quot;    </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6] &quot;Vietnam&quot;     &quot;Zimbabwe&quot;</span></span></code></pre></div>
</div>
<p>A useful package for dealing with factors in R is <a href="https://forcats.tidyverse.org/">{forcats}</a> whose functions all start with <code>fct_*</code>. One way of dealing with this is changing the factor level order in the data before passing it to ggplot. Here, we may simply reverse the order via <code>fct_rev()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(country), <span class="sc">~</span> <span class="fu">fct_rev</span>(.x)))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dat<span class="sc">$</span>country)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Zimbabwe&quot;    &quot;Vietnam&quot;     &quot;Nigeria&quot;     &quot;Netherlands&quot; &quot;Japan&quot;      </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6] &quot;Germany&quot;     &quot;Canada&quot;</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>())</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
<div class="cell">
<details>
<summary>Alternative 1</summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively, you may apply fct_rev() inside aes() instead of altering the data beforehand </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> <span class="fu">fct_rev</span>(country), <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>())</span></code></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Alternative 2</summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively, you may manually provide the levels in the desired order within scale_y_discrete()</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;Zimbabwe&quot;</span>, <span class="st">&quot;Vietnam&quot;</span>, <span class="st">&quot;Nigeria&quot;</span>, <span class="st">&quot;Netherlands&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;Canada&quot;</span>))</span></code></pre></div>
</details>
</div>
<p>However, it probably makes more sense to sort the countries according to the data. Here, we could sort them according to their life expectancy in 2007.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sorted_countries <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">&quot;2007&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lifeExp) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">fct_relevel</span>(country, sorted_countries))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>())</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
<p>Next, we address the order of years in the plot and the legend. As you can see in the previous plots, once more the first factor level (1952) is on the bottom, while the second level (2007) is on top. Thus, we could use one of the approaches shown for <code>country</code> to change that. More precisely, let’s take the approach of <em>Alternative 1</em> and use <code>fct_rev()</code> inside the <code>aes()</code>.</p>
<p>Note however, that while this changes the order of the years in the plot, it does not affect their order in the legend. To address that, we can use the <code>limits =</code> argument in <code>scale_fill_manual()</code> (which corresponds to <em>Alternative 2</em> above):</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span>, <span class="st">&quot;2007&quot;</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
<div class="cell">
<details>
<summary>Alternative</summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively, you may reverse the legend order via guides()</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="reproducing-a-theme" class="level2">
<h2>reproducing a theme</h2>
<p>Now that we’ve got the basics correct, the next thing I would want to change is things like the theme, i.e. the non-data components of the plot: titles, labels, fonts, background, gridlines, and legends.</p>
<p>Using <code>theme()</code> allows us to format our plot in any way we want. Instead of picking things based on what feels good, let us here try to recreate the layout of a plot published in <a href="https://doi.org/10.1038/d41586-019-03305-w"><em>Nature</em></a> in ‘150 years of Nature: a data graphic charts our evolution’ by Richard Monastersky &amp; Richard Van Noorden (2019). <a href="https://media.nature.com/lw767/magazine-assets/d41586-019-03305-w/d41586-019-03305-w_17345518.png">URL to the plot</a>.</p>
<p><img src="https://media.nature.com/lw767/magazine-assets/d41586-019-03305-w/d41586-019-03305-w_17345518.png" class="img-fluid" /></p>
<p>Thus, a better starting point would be to use the <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">complete theme</a> <code>theme_minimal()</code> instead of the default <code>theme_gray()</code>. From here, we can further adjust things via <code>theme()</code>.</p>
<p>Furthermore, let’s also pick two of the colors used in that image (e.g. via any <a href="https://google.gprivate.com/search.php?search?q=pick+color+from+image+online">online color picker</a>) for our years. We can create a named vector <code>year_colors</code> and when changing <code>scale_fill_discrete()</code> to <code>scale_fill_manual()</code> supply it via the <code>values =</code> argument.</p>
<p>Finally, as our ggplot-code is getting longer, let’s start saving out current plot into an object <code>p</code> and reuse it.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>year_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span> <span class="ot">=</span> <span class="st">&quot;#F7AA59&quot;</span>, <span class="st">&quot;2007&quot;</span> <span class="ot">=</span> <span class="st">&quot;#37A9E1&quot;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">names</span>(year_colors), </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> year_colors) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
<section id="font" class="level3">
<h3>font</h3>
<p>To further replicate the aesthetics of the Nature plot, we introduce a custom font named <em>Kanit</em>. This font, available through <a href="https://fonts.google.com/">Google Fonts</a>, has been chosen for its stylistic resemblance to the one used in the Nature publication.</p>
<p>The process begins by fetching the font from Google Fonts and making it available for use in our R session via <code>sysfonts::font_add_google("Kanit", "kanit")</code>. Next, <code>showtext::showtext_auto()</code> activates the use of custom fonts in plots. It’s important to also run <code>showtext::showtext_opts(dpi = 300)</code> to avoid getting unexpected results. This is because <code>{showtext}</code> uses a default of 72 dpi, while e.g. exporting plots via <code>ggsave()</code> defaults to <code>dpi = 300</code>. Furthermore, you may also want the dpi to be 300 (or some other number) when rendering plots within your RMarkdown via <code>knitr::opts_chunk$set(dpi = 300)</code> or quarto document via <code>fig-dpi: 300</code>.</p>
<p>We add a title and subtitle via <code>labs()</code> and then apply the font to all text elements via <code>text = element_text(family = "kanit")</code>. For some reason, the default position of title and subtitle in a ggplot is left-aligned with the y-axis - to instead left-align it with the left side of the entire plot, we apply <code>plot.title.position = "plot"</code>. Making the title a bit bigger and bold is straightforward. However, having a subtitle (or other text elements) that has automatic line breaks when the string is too long actually requires <code>{ggtext}</code> and more specifically a <code>ggtext::element_textbox_simple()</code> instead of the default <code>ggplot2::element_text()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sysfonts<span class="sc">::</span><span class="fu">font_add_google</span>(<span class="st">&quot;Kanit&quot;</span>, <span class="st">&quot;kanit&quot;</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>showtext<span class="sc">::</span><span class="fu">showtext_auto</span>()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We already did this above, but dont forget about it:</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># showtext::showtext_opts(dpi = 300)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>long_subtitle <span class="ot">&lt;-</span> <span class="st">&quot;In the mid-twentieth century, global life expectancy was shaped by post-war recovery, with variations across countries. As decades progressed, public health advances and socioeconomic growth painted a new picture of longevity. The data now reflect a world where life expectancy in 2007 often mirrors an improved quality of life compared to 1952.&quot;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;LIFE EXPECTANCY&quot;</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> long_subtitle</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;kanit&quot;</span>)) <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> ggtext<span class="sc">::</span><span class="fu">element_textbox_simple</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">0</span>))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="axes" class="level3">
<h3>axes</h3>
<p>For our specific goal, we start by removing the axis titles as well as unnecessary space beyond the limits of each axis. Furthermore, there should be no axis line for the y-axis and a relatively thick black line with grey ticks for the x-axis. More details on axis formatting can be found <a href="https://schmidtpaul.github.io/dsfair_quarto/ch/summaryarticles/ggplot2intro.html#axes">here</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>, <span class="co"># remove title</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>) <span class="co"># no extra space above or below</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>, <span class="co"># remove title</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)) <span class="co"># only 5% extra space above upper limit</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(), <span class="co"># remove line on y-axis</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>), <span class="co"># x-axis label color</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>), <span class="co"># x-axis tick color &amp; width</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.length.x =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>), <span class="co"># x-axis tick length</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="co"># x-axis line color &amp; width</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="legend" class="level3">
<h3>legend</h3>
<p>Our legend is supposed to be above the plot and left-aligned. We partly achieve this via <code>legend.position</code>, <code>legend.box.just</code> and <code>legend.justification</code>, but unfortunately this does not fully achieve the goal. We want to have a legend that is left-aligned with respect to the entire plot, not to the y-axis. As far as I know and unlike <code>plot.title.position = "plot"</code> which we used above, there is no way of achieving this normally. Thus, we here use a hack by setting the left <code>margin()</code> of the legend to a negative value that looks good enough.</p>
<p>Besides the position, the legend title is made bold via <code>legend.title = element_text(face = "bold")</code> and we force all elements of the legend to be in one row via <code>guide_legend(title.position = "left", nrow = 1)</code>. Finally, the size of the colored squares in the legend is reduced via <code>legend.key.size = unit(0.4, "cm")</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">title.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.just =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.justification =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">57</span>, <span class="at">unit =</span> <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="grid-lines" class="level3">
<h3>grid lines</h3>
<p>Lastly, we could adjust the grid lines. By default, ggplot has major and minor grid lines for both axes. Yet, we only want thin, dotted, grey lines for the major grid of the x-axis:</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
</section>
<section id="improve-the-plot" class="level2">
<h2>improve the plot</h2>
<p>We have now mostly reproduced the layout of the <em>Nature</em> plot and applied it to our plot. At this point, we could try out things that may improve the plot.</p>
<section id="labels" class="level3">
<h3>labels</h3>
<p>In certain cases it can be beneficial to additionally label data points. In this plot, we may simply label each bar with rounded life expectancy it represents. We here do so via <code>geom_text()</code> where <code>aes(label = round(lifeExp))</code>. Note that we also need to add <code>group = fct_rev(year)</code> here. This is because so far we applied <code>fill = fct_rev(year)</code> in the general <code>aes()</code> which led to different groups due to the different fill colors so that <code>geom_col(position = position_dodge())</code> knew which groups/bars were supposed to be dodged. However, our labels created via <code>geom_text()</code> do not have a fill attribute but should still be dodged per year in the same way. Hence, <code>group = fct_rev(year)</code> is required and moreover, <code>position_dodge(width = 0.9)</code> actually needs a width value here set to the default dodge width for bars.</p>
<p>Once this is out the way, we make the text white and right-align it with extra space via a value for <code>hjust</code> that is larger than 1. Finally, don’t forget to apply <code>family = "kanit"</code> here as well, as geoms are not part of the <code>theme()</code> and thus this <code>geom_text()</code> knows nothing about Kanit.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(lifeExp), <span class="at">group =</span> <span class="fu">fct_rev</span>(year)), </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">1.1</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="remove-legend" class="level3">
<h3>remove legend</h3>
<p>This comes down to personal preferences, but we could remove the legend entirely by instead coloring the subtitle in a way that clarifies what the colors stand for. Here this means that 1952 should be orange and 2007 blue. This is once more made possible via {ggtext} as it allows to use HTML rendering for text in ggplot. This means e.g. that that writing <code>A &lt;b style='color:red;'&gt; red &lt;/b&gt; word</code> results in “A <b style='color:red;'> red </b> word”. Let us therefore rewrite the subtitle accordingly:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>new_long_subtitle <span class="ot">&lt;-</span> <span class="st">&quot;In the mid-twentieth century, global life expectancy was shaped by post-war recovery, with variations across countries. As decades progressed, public health advances and socioeconomic growth painted a new picture of longevity. The data now reflect a world where life expectancy in &lt;b style=&#39;color:#37A9E1;&#39;&gt;2007&lt;/b&gt; often mirrors an improved quality of life compared to &lt;b style=&#39;color:#F7AA59;&#39;&gt;1952&lt;/b&gt;.&quot;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;LIFE EXPECTANCY&quot;</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> new_long_subtitle</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">&quot;none&quot;</span>) </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Be aware that we don&#39;t need to this here because we already</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># did so earlier to have automatic line breaks, but without</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># formatting the subtitle as a ggtext element, it would</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># not understand the html commnand:</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theme(plot.subtitle = ggtext::element_textbox_simple())</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="dumbbell-plot" class="level3">
<h3>dumbbell plot</h3>
<p>When it comes to visualizing changes or differences between two data points (like life expectancy across two different years in our case), dumbbell plots can offer a clearer and more direct comparison than grouped bar plots. While grouped bar plots efficiently display the individual values, dumbbell plots excel in highlighting the actual change or difference between these values. They connect the two data points with a line, making it visually immediate to see the extent of change. This is particularly beneficial in cases where the focus of the analysis is on the change itself rather than the absolute values. Moreover, dumbbell plots reduce clutter and can be easier to read when dealing with a large number of categories. By using different colors for the points and a subtle line to connect them, dumbbell plots provide a balanced emphasis on both the individual data points and their relative change, thereby offering a more nuanced view of the data. This makes them an excellent choice for our comparison of life expectancies over time.</p>
<p>To create such a dumbbell plot, we need a transformed, wide version of our data (more on long/wide format <a href="https://schmidtpaul.github.io/dsfair_quarto/ch/rbasics/tidyverse.html#longwide-format">here</a>):</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dat_lifeExp_wide <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, lifeExp) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> lifeExp, <span class="at">names_prefix =</span> <span class="st">&#39;year_&#39;</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>dat_lifeExp_wide</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 7 × 3</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country     year_1952 year_2007</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;           &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Canada           68.8      80.7</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Germany          67.5      79.4</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Japan            63.0      82.6</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Netherlands      72.1      79.8</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Nigeria          36.3      46.9</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Vietnam          40.4      74.2</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 Zimbabwe         48.5      43.5</span></span></code></pre></div>
</div>
<p>Furthermore, we need most of what we did so far again with our ggplot object <code>p</code> again, but we do need to make some changes, which is why it makes sense to recreate <code>p2</code> from scratch. All the theme elements will stay the same for now, so let’s wrap them in our own custom theme:</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>theme_nature <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">base_size =</span> <span class="dv">12</span>) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> base_size) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;kanit&quot;</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> ggtext<span class="sc">::</span><span class="fu">element_textbox_simple</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">0</span>)),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks.length.x =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>),</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.box.just =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,<span class="sc">-</span><span class="dv">57</span>, <span class="at">unit =</span> <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">linewidth =</span> <span class="fl">0.3</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>Thus, when using our newly created <code>theme_nature()</code>, we can focus on the changes in the other parts of our ggplot we made even before adding any new geoms:</p>
<ul>
<li>in the general <code>aes()</code> we use <code>color = fct_rev(year)</code> instead of <code>fill = fct_rev(year)</code></li>
<li>accordingly, we also use <code>scale_color_manual()</code> instead of <code>scale_fill_manual()</code></li>
<li>Above, we turned off the legend in a later step via <code>guides(fill = "none")</code>. This time, we immediately set <code>guide = "none"</code> within <code>scale_color_manual()</code>.</li>
<li>we actually do want extra space beyond the limits for both axes so we remove the <code>expand =</code> statements</li>
<li>we no longer need bars created via <code>geom_col()</code></li>
<li>we no longer the labels created via <code>geom_text()</code></li>
</ul>
<p>Given this, we have a well-prepared ggplot in need of geoms:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>p2_base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">color =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span>, <span class="st">&quot;2007&quot;</span>), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> year_colors, </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;LIFE EXPECTANCY&quot;</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> new_long_subtitle</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_nature</span>()</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>p2_base</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
<p>We only need two geoms to create a dumbbell plot here: <a href="https://ggplot2.tidyverse.org/reference/geom_segment.html"><code>geom_segment()</code></a> draws a straight line between points (<code>x</code>, <code>y</code>) and (<code>xend</code>, <code>yend</code>), which works nicely with the <code>dat_lifeExp_wide</code> created above. Note that the <code>color = "#AAAAAA"</code> overrides the <code>color = fct_rev(year)</code> from the general <code>aes()</code> that would otherwise apply. The points are automatically created and colored via <code>geom_point()</code> based on <code>dat</code> and the general <code>aes()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p2_base <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_lifeExp_wide,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_1952, <span class="at">xend =</span> year_2007, <span class="at">y =</span> country, <span class="at">yend =</span> country),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>p2</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="labels-again" class="level3">
<h3>labels again</h3>
<p>Once again we can decide additionally have data points labeled with their values. We can easily add the rounded life expectancy above each point by basically using the same general aesthetics as <code>geom_point()</code> but vertically justifying a bit upwards.</p>
<p>Yet, even more informative is the actual difference between 2007 and 1952. For that, we can use <code>dat_lifeExp_wide</code> again where we already have one column per year and can subtract them into a new column <code>diff</code>. For easier readability we then format that result by first rounding it and then making it into a string <code>diff_lab</code> that always displays “+” or “-” in front of the respective number. I want to position this label on the right side of each dumbbell and could easily do so if the life expectancy were always higher for 2007 but this is not the case for Zimbabwe. Thus, I am also creating a helper column <code>max_x</code> which is simply the maximum life expectancy of the two years or in other words the right side of the dumbbell. We now have everything we need to use a second <code>geom_text</code> where we use <code>dat = dat_lifeExp_wide</code> instead of the dataset provided in <code>ggplot(data = dat)</code> and set the aesthetics as <code>aes(x = max_x, label = diff_lab)</code>. So far, our labels would be on top of the point of the right side of the dumbbell. Thus, we add <code>position = position_nudge(x = 1)</code> to nudge the position for the label one year to the right and additionally use <code>hjust = 0</code> so that the label is not centered but instead left-aligned to that nudged position.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dat_lifeExp_wide <span class="ot">&lt;-</span> dat_lifeExp_wide <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_x =</span> <span class="fu">pmax</span>(year_2007, year_1952),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff =</span> year_2007 <span class="sc">-</span> year_1952,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_lab =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%+d&quot;</span>, <span class="fu">round</span>(diff))</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p2 <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(lifeExp)),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_lifeExp_wide,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> max_x, <span class="at">label =</span> diff_lab),</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="dv">1</span>),</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>p2</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
</section>
</section>
<section id="part-3-multiple-plots" class="level1">
<h1>Part 3: Multiple plots</h1>
<p>Let us take a step back and look at our data again to realize that we also have information about population and GDP per capita for each country in each year:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14 × 6</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    country     continent year  lifeExp       pop gdpPercap</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;fct&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Canada      Americas  1952     68.8  14785584    11367.</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Canada      Americas  2007     80.7  33390141    36319.</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Germany     Europe    1952     67.5  69145952     7144.</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Germany     Europe    2007     79.4  82400996    32170.</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Japan       Asia      1952     63.0  86459025     3217.</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Japan       Asia      2007     82.6 127467972    31656.</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Netherlands Europe    1952     72.1  10381988     8942.</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Netherlands Europe    2007     79.8  16570613    36798.</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Nigeria     Africa    1952     36.3  33119096     1077.</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Nigeria     Africa    2007     46.9 135031164     2014.</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 Vietnam     Asia      1952     40.4  26246839      605.</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 Vietnam     Asia      2007     74.2  85262356     2442.</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13 Zimbabwe    Africa    1952     48.5   3080907      407.</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 Zimbabwe    Africa    2007     43.5  12311143      470.</span></span></code></pre></div>
</div>
<p>Thus, we could simply create the same ggplot three times: once for each variable. While this is certainly an option and call for packages such as <a href="https://patchwork.data-imaginist.com/">{patchwork}</a> or <a href="https://wilkelab.org/cowplot/index.html">{cowplot}</a>, we can also achieve our goal via facets within the same ggplot.</p>
<section id="data-prep-1" class="level2">
<h2>data prep</h2>
<p>To do that, we need to restructure our data so that all values are in the same column:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dat_long <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(lifeExp, pop, gdpPercap),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;statistic&quot;</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>dat_long</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 42 × 5</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    country continent year  statistic      value</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt; &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Canada  Americas  1952  lifeExp         68.8</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Canada  Americas  1952  pop       14785584  </span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Canada  Americas  1952  gdpPercap    11367. </span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Canada  Americas  2007  lifeExp         80.7</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Canada  Americas  2007  pop       33390141  </span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Canada  Americas  2007  gdpPercap    36319. </span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Germany Europe    1952  lifeExp         67.5</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Germany Europe    1952  pop       69145952  </span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Germany Europe    1952  gdpPercap     7144. </span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Germany Europe    2007  lifeExp         79.4</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 32 more rows</span></span></code></pre></div>
</div>
<p>Moreover, we need a <code>dat_all_wide</code> instead of the <code>dat_lifeExp_wide</code> from above:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dat_all_wide <span class="ot">&lt;-</span> dat_long <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> value, <span class="at">names_prefix =</span> <span class="st">&#39;year_&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_x =</span> <span class="fu">pmax</span>(year_2007, year_1952),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff =</span> year_2007 <span class="sc">-</span> year_1952,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_lab =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%+d&quot;</span>, <span class="fu">round</span>(diff))</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<p>Finally, besides changing title and subtitle, the most important change is to add <code>facet_wrap(facets = ~ statistic, scales = "free_x")</code> so that we get one plot per value in the <code>statistic</code> column while their x-axes are allowed to have different scales:</p>
</section>
<section id="facets" class="level2">
<h2>facets</h2>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>another_long_subtitle <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;In &lt;b style=&#39;color:&quot;</span>, year_colors[[<span class="st">&quot;2007&quot;</span>]], <span class="st">&quot;;&#39;&gt;2007&lt;/b&gt;, compared to &lt;b style=&#39;color:&quot;</span>, year_colors[[<span class="st">&quot;1952&quot;</span>]],<span class="st">&quot;;&#39;&gt;1952&lt;/b&gt;, life expectancy, Gross Domestic Product (GDP) per capita, and population data collectively reflect significant advancements in health, economic prosperity, and demographic trends, illustrating an overall enhanced quality of life.&quot;</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat_long) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> country, <span class="at">color =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="sc">~</span> statistic, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span>, <span class="st">&quot;2007&quot;</span>), </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> year_colors,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;GDP, LIFE EXPECTANCY &amp; POPULATION&quot;</span>,</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> another_long_subtitle</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_nature</span>() <span class="sc">+</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_all_wide,</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_1952, <span class="at">xend =</span> year_2007, <span class="at">y =</span> country, <span class="at">yend =</span> country),</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(value)),</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_all_wide,</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> max_x, <span class="at">label =</span> diff_lab),</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="dv">1</span>),</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="individual-labels" class="level2">
<h2>individual labels</h2>
<p>So technically this worked, but it obviously needs some tweaking. First, the facets should have nicer labels than just the variable names. Moreover, while it is helpful that the x-axes of the different facets were allowed to have different scales/limits, the vast difference between magnitude of the three variables leads to problematic labels for both the axes and inside the plot. As a result, simply rounding the numbers is still appropriate for life expectancy, but not for the other two. We therefore create a new column <code>value_lab</code> in which labels for each point are defined depending on what statistic it is. A convenient way to create such formatted numbers is the <code>scales::number()</code> function. Besides <code>value_lab</code> in <code>dat_long</code>, we also recreate <code>diff_lab</code> in <code>dat_all_wide</code> this way, additionally adding the +/-. Finally note that also the method of positioning the label on the right side of the dumbbell no longer works. One way of fixing it is also creating a new column <code>x_pos_lab</code> which adds a certain value to <code>max_x</code> depending on the statistic.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dat_long <span class="ot">&lt;-</span> dat_long <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_lab =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;lifeExp&quot;</span>   <span class="sc">~</span> <span class="fu">number</span>(value, <span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;pop&quot;</span>       <span class="sc">~</span> <span class="fu">number</span>(value, <span class="at">accuracy =</span> <span class="dv">1</span>,   <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000000</span>, <span class="at">suffix =</span> <span class="st">&quot;m&quot;</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;gdpPercap&quot;</span> <span class="sc">~</span> <span class="fu">number</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span>,    <span class="at">suffix =</span> <span class="st">&quot;k&quot;</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>dat_all_wide <span class="ot">&lt;-</span> dat_all_wide <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_lab =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;lifeExp&quot;</span>   <span class="sc">~</span> <span class="fu">number</span>(</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        diff,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_positive =</span> <span class="st">&quot;plus&quot;</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_negative =</span> <span class="st">&quot;minus&quot;</span>,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="dv">1</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;pop&quot;</span>       <span class="sc">~</span> <span class="fu">number</span>(</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        diff,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_positive =</span> <span class="st">&quot;plus&quot;</span>,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_negative =</span> <span class="st">&quot;minus&quot;</span>,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="dv">1</span>,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="st">&quot;m&quot;</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;gdpPercap&quot;</span> <span class="sc">~</span> <span class="fu">number</span>(</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        diff,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_positive =</span> <span class="st">&quot;plus&quot;</span>,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_negative =</span> <span class="st">&quot;minus&quot;</span>,</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="fl">0.1</span>,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="st">&quot;k&quot;</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">x_pos_lab =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;lifeExp&quot;</span>   <span class="sc">~</span> max_x <span class="sc">+</span> <span class="dv">3</span>,</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;pop&quot;</span>       <span class="sc">~</span> max_x <span class="sc">+</span> <span class="dv">10000000</span>,</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;gdpPercap&quot;</span> <span class="sc">~</span> max_x <span class="sc">+</span> <span class="dv">3000</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<p>We can then apply these new labels to our faceted ggplot. We also provide labels per facet via <code>labeller = labeller(statistic = ...)</code>. Finally note that even though we shortened the labels, they will still overlap in some cases where the points are too close to each other. One solution is to have the 1952-label below and the 2007-label above the point which can be achived by moving the <code>vjust</code> inside the <code>aes()</code> and having it depend on the year via <code>vjust = if_else(year == "1952", 2, -1)</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>facet_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">lifeExp =</span> <span class="st">&quot;Life Expectancy [years]&quot;</span>, <span class="at">pop =</span> <span class="st">&quot;Population&quot;</span>, <span class="at">gdpPercap =</span> <span class="st">&quot;GDP per Capita [$]&quot;</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat_long) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> country, <span class="at">color =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">facets =</span> <span class="sc">~</span> statistic,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">statistic =</span> facet_labels)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span>, <span class="st">&quot;2007&quot;</span>), </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> year_colors,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;GDP, LIFE EXPECTANCY &amp; POPULATION&quot;</span>,</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> another_long_subtitle</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_nature</span>() <span class="sc">+</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_all_wide,</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_1952, <span class="at">xend =</span> year_2007, <span class="at">y =</span> country, <span class="at">yend =</span> country),</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">vjust =</span> <span class="fu">if_else</span>(year <span class="sc">==</span> <span class="st">&quot;1952&quot;</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_all_wide,</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_pos_lab, <span class="at">label =</span> diff_lab),</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>p3</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="individual-scales" class="level2">
<h2>individual scales</h2>
<p>However, the axes are still not optimal for two reasons: The axis labels do not look good except for Life Expectancy and the labels inside the plots are sometimes cut off due to the axis limits. Adjusting axes per facet is actually not possible/straightforward via {ggplot2} so we need load <a href="https://teunbrand.github.io/ggh4x/index.html">{ggh4x}</a> to make use of <code>facetted_pos_scales</code>. Note that we can use <code>labels = scales::number_format()</code> in basically the same way as we used <code>scales::number()</code> above. Moreover, we choose good combinations of <code>limits</code> and <code>expand</code> to make sure no labels are cut off and finally pick <code>breaks</code> via the convenient <code>scales::breaks_width()</code> function:</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> p3 <span class="sc">+</span> <span class="fu">facetted_pos_scales</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">list</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;lifeExp&quot;</span> <span class="sc">~</span> <span class="fu">scale_x_continuous</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">90</span>),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">breaks_width</span>(<span class="dv">20</span>),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;pop&quot;</span> <span class="sc">~</span> <span class="fu">scale_x_continuous</span>(</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150000000</span>),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.2</span>)),</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">breaks_width</span>(<span class="dv">50000000</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">number_format</span>(</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="dv">1</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="st">&quot;m&quot;</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;gdpPercap&quot;</span> <span class="sc">~</span> <span class="fu">scale_x_continuous</span>(</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50000</span>),</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.075</span>, <span class="fl">0.075</span>)),</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">breaks_width</span>(<span class="dv">25000</span>),</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">number_format</span>(</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="dv">1</span>,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="st">&quot;k&quot;</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="co"># apparently necessary?!</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>p3</span></code></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" style="width:100.0%" /></p>
</div>
</div>
</section>
</section>
<section id="todo" class="level1">
<h1>TODO</h1>
<ul>
<li>After first plot: Talk about exporting and then about looking at your plot not in the RStudio preview window. Maybe even introduce {camcorder}</li>
<li>Choosing colors / use viridis colors instead</li>
<li>Have full code to get final each plot in a single folded chunk</li>
<li>Packages in tutorial description but not in tutorial yet: cowplot, ggrepel, viridis</li>
<li>BioMath Logo/Link on Website</li>
<li>BioMath in Citation</li>
</ul>
<div id="quarto-navigation-envelope" class="hidden">
<span class="hidden" data-render-id="quarto-int-sidebar-title">70BiomColl_AdvDataVisR</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Tutorial: Advanced data visualization in R</span> <span class="hidden" data-render-id="quarto-int-navbar:Contact">Contact</span> <span class="hidden" data-render-id="quarto-int-navbar:https://schmidtpaul.github.io/">https://schmidtpaul.github.io/</span> <span class="hidden" data-render-id="quarto-int-navbar:https://github.com/SchmidtPaul/70BiomColl_AdvDataVisR">https://github.com/SchmidtPaul/70BiomColl_AdvDataVisR</span> []{.hidden render-id=“footer-right-
<p>
All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
</p>
<p>“}</p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">70BiomColl_AdvDataVisR - Tutorial: Advanced data visualization in R</span> <span class="hidden" data-render-id="quarto-twittercardtitle">70BiomColl_AdvDataVisR - Tutorial: Advanced data visualization in R</span> <span class="hidden" data-render-id="quarto-ogcardtitle">70BiomColl_AdvDataVisR - Tutorial: Advanced data visualization in R</span> <span class="hidden" data-render-id="quarto-metasitename">70BiomColl_AdvDataVisR</span> <span class="hidden" data-render-id="quarto-twittercarddesc">70th Biometrical Colloquium 2024 in Luebeck</span> <span class="hidden" data-render-id="quarto-ogcardddesc">70th Biometrical Colloquium 2024 in Luebeck</span></p>
</div>
<!-- -->
<div class="quarto-embedded-source-code">
<div class="sourceCode" id="cb39" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;Tutorial: Advanced data visualization in R&quot;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> &quot;70th Biometrical Colloquium 2024 in Luebeck&quot;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 4</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-dpi: 300</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 6</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-align: center</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">    include-in-header: header.html</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf: default</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk:</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">    out.width: 100%</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">    fig.showtext: TRUE</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">    collapse: true</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co">    comment: &quot;#&gt;&quot;</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">class.output =</span> <span class="st">&quot;custom-output&quot;</span>)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>This is the supporting material for the tutorial **Advanced data visualization in R** which is part of the 70th Biometrical Colloquium 2024 in Luebeck and takes place 28.02.2024 09:00-12:00. Here is the tutorial description as displayed on the <span class="co">[</span><span class="ot">website&#39;s conference program</span><span class="co">](https://www.biometrische-gesellschaft.de/en/events/biometric-colloquia/70th-biometrical-colloquium-2024-in-luebeck/conference-program.html)</span>:</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **Advanced data visualization in R: (Re)producing professional plots with ggplot2 and the tidyverse**</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Lecturer: Paul Schmidt (BioMath GmbH, Hamburg)</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Learning objectives:</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; -   Deep dive into ggplot2: Understand the intricacies of ggplot2 for top-tier data visualization</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; -   Data manipulation with tidyverse: Utilize packages like dplyr, tidyr, and forcats to shape data optimally for creating graphs</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; -   Aesthetic fine-tuning: Master the skills of axis formatting, theme detailing, and color selection</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; -   Reproducing Exercise: Recreate published plots to understand the application of ggplot2 techniques in real-world scenarios</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; -   Exporting excellence: Learn best practices for exporting plots in publication-ready formats</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Target group:</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; -   Anyone wanting to produce or present high-quality plots. Conveying complex data insights through refined visualizations is a relevant part of statistical analysis</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Prerequisites:</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; -   Basic understanding of R programming is required</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; -   Basic knowledge of ggplot2 and the tidyverse is beneficial, but not required</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; -   R-packages: tidyverse, cowplot, ggrepel, ggtext, viridis</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Format: Hybrid</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a><span class="fu"># Part 0: Setup</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>Notice that we expect participants with different levels of experience in this tutorial. Furthermore, the tutorial duration is only 3 hours and thus quite short. As a consequence, this material often links to other resources with more detailed information instead of blowing up the content of this material. However, where possible, these links don&#39;t simply lead to official online documentation etc. which may be hard to grasp for beginners, but instead to other workshop content created by this tutorial&#39;s main lecturer.</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>The decision on which plots to create in this workshop was inspired by <span class="co">[</span><span class="ot">this blog post</span><span class="co">](https://albert-rapp.de/posts/ggplot2-tips/15_alternative_paired_bars/15_alternative_paired_bars.html)</span> by <span class="co">[</span><span class="ot">Albert Rapp</span><span class="co">](https://albert-rapp.de/)</span> whose R and data visualization content is worth checking out!</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>You will need to install and load the following packages</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;camcorder&quot;</span>)</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;cowplot&quot;)</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;gapminder&quot;</span>)</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggh4x&quot;</span>)</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;ggrepel&quot;)</span></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggtext&quot;</span>)</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;scales&quot;</span>)</span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;showtext&quot;</span>)</span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;viridis&quot;)</span></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(camcorder)</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a><span class="co"># library(cowplot)</span></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggh4x)</span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggrepel)</span></span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a><span class="co"># library(viridis)</span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>showtext<span class="sc">::</span><span class="fu">showtext_opts</span>(<span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">interactive</span>()) { <span class="co"># this does not run when rendering the qmd fileq</span></span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>  camcorder<span class="sc">::</span><span class="fu">gg_record</span>(</span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">dir =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;recording100&quot;</span>), <span class="co"># where to save the recording</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">6</span>, </span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, </span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a><span class="fu"># Part 1: Export</span></span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>This might be a bit unexpected, but I would argue that the very first thing we should talk about is exporting your ggplots. A major reason for this is the fact that by default you would create your ggplots by looking at them in the &quot;Plots&quot; preview window in RStudio. While this is not a problem *per se*, it becomes problematic once you realize the scale/size of your ggplot automatically adjusts to the size of your preview window. This is especially annoying regarding font sizes. Try it out: Create the following ggplot and then play around with width and height of your &quot;Plots&quot; panel in RStudio:</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>myplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> mtcars) <span class="sc">+</span></span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> mpg, <span class="at">x =</span> hp) <span class="sc">+</span></span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>You may get results like this:</span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a>::: {.column width=&quot;49%&quot;}</span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 3</span></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 1</span></span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a>myplot</span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a>::: {.column width=&quot;2%&quot;}</span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>::: {.column width=&quot;49%&quot;}</span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>myplot</span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a>As far as I know, there are two ways of properly dealing with this.</span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a><span class="fu">## Export and open file</span></span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a>To avoid the issue, you may simply never look at the preview of your ggplot in RStudio and instead always export your plot to then look at the exported file. Exporting a ggplot is flexible and convenient. You can choose a device function (e.g. <span class="co">[</span><span class="ot">png</span><span class="co">](https://www.rdocumentation.org/packages/grDevices/versions/3.4.1/topics/png)</span>) or &quot;eps&quot;, &quot;ps&quot;, &quot;tex&quot; (pictex), &quot;pdf&quot;, &quot;jpeg&quot;, &quot;tiff&quot;, &quot;png&quot;, &quot;bmp&quot;, &quot;svg&quot; or &quot;wmf&quot; (windows only). Furthermore, you can set width and height in a unit of your choice and depending on your file type even choose the dpi and more.</span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;myfile.png&quot;</span>,</span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> myplot,</span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">6</span>, </span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a>You don&#39;t even need to manually open the file after creating it if you instead run this:</span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&#39;open &quot;myfile.png&quot;&#39;</span>)</span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a><span class="fu">## Use {camcorder}</span></span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a>There is a package called <span class="co">[</span><span class="ot">`{camcorder}`</span><span class="co">](https://thebioengineer.github.io/camcorder/)</span> which advertises its &quot;eventual goal of creating a GIF showing all the plots saved sequentially during the design process&quot; like in <span class="co">[</span><span class="ot">these examples</span><span class="co">](https://thebioengineer.github.io/camcorder/#goal-end-product)</span>. However, I am <span class="co">[</span><span class="ot">not the only one</span><span class="co">](https://albert-rapp.de/posts/ggplot2-tips/12_a_few_gg_packages/12_a_few_gg_packages.html#camcorder)</span> using camcorder for its feature of fixing the canvas size. In other words: It shows your ggplot in the RStudio panel fixed to your chosen scale. Thus, simply run something like this at the beginning of your session so that all ggplots shown afterwards are exactly 6x4 inches wide with dpi 300:</span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a>  camcorder<span class="sc">::</span><span class="fu">gg_record</span>(</span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">6</span>, </span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, </span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-197"><a href="#cb39-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-198"><a href="#cb39-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a>Note that it actually does not show up in RStudio&#39;s &quot;Plots&quot; but in its &quot;Viewer&quot; panel. Furthermore, note that it actually saves the intermediate plots somewhere, but defaults to a temporary directory for that.</span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a><span class="fu"># Part 2: A single plot</span></span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a>Let us first create a single plot to compare the life expectancy between 1952 and 2007 for seven countries, respectively.</span>
<span id="cb39-204"><a href="#cb39-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-205"><a href="#cb39-205" aria-hidden="true" tabindex="-1"></a><span class="fu">## data prep</span></span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a>The data is courtesy of <span class="co">[</span><span class="ot">the Gapminder foundation</span><span class="co">](https://www.gapminder.org/)</span> and can easily be accessed via the <span class="co">[</span><span class="ot">{gapminder}</span><span class="co">](https://jennybc.github.io/gapminder/)</span> package. We can then make use of <span class="co">[</span><span class="ot">the pipe operator `%&gt;%`</span><span class="co">](https://schmidtpaul.github.io/dsfair_quarto/ch/rbasics/tidyverse.html#the-pipe-operator)</span> to create a subset of the data via the <span class="co">[</span><span class="ot">`filter()` function</span><span class="co">](https://schmidtpaul.github.io/dsfair_quarto/ch/rbasics/tidyverse.html#filter)</span>. Then, in order for our ggplot to work as intended in the next step, we also need to format the year column as a factor instead of an integer value via <span class="co">[</span><span class="ot">`mutate()`</span><span class="co">](https://schmidtpaul.github.io/dsfair_quarto/ch/rbasics/tidyverse.html#mutate)</span>. Both functions are from the <span class="co">[</span><span class="ot">{dplyr}</span><span class="co">](https://dplyr.tidyverse.org/)</span> package which we loaded as part of the <span class="co">[</span><span class="ot">{tidyverse}</span><span class="co">](https://www.tidyverse.org/)</span>. Finally, we use <span class="in">`droplevels()`</span> to get rid of the factor levels that are now no longer present in the data (i.e. the countries we did not filter for).</span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> gapminder<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1952</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-214"><a href="#cb39-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Netherlands&quot;</span>, <span class="st">&quot;Nigeria&quot;</span>, <span class="st">&quot;Vietnam&quot;</span>, <span class="st">&quot;Zimbabwe&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-215"><a href="#cb39-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-216"><a href="#cb39-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb39-217"><a href="#cb39-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-218"><a href="#cb39-218" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb39-219"><a href="#cb39-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-220"><a href="#cb39-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-221"><a href="#cb39-221" aria-hidden="true" tabindex="-1"></a><span class="fu">## base plot</span></span>
<span id="cb39-222"><a href="#cb39-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-223"><a href="#cb39-223" aria-hidden="true" tabindex="-1"></a>One typical way you may find data like this visualized is via a grouped bar plot. The minimum amount of code to create such a plot via ggplot is this:</span>
<span id="cb39-224"><a href="#cb39-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-225"><a href="#cb39-225" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-226"><a href="#cb39-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-227"><a href="#cb39-227" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-228"><a href="#cb39-228" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb39-229"><a href="#cb39-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb39-230"><a href="#cb39-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>())</span>
<span id="cb39-231"><a href="#cb39-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-232"><a href="#cb39-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-233"><a href="#cb39-233" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Read this</span><span class="co">](https://schmidtpaul.github.io/dsfair_quarto/ch/summaryarticles/ggplot2intro.html#lets-start)</span> if you are not familiar with the general ggplot syntax. We need to add <span class="in">`position = position_dodge()`</span> to <span class="in">`geom_col()`</span>, since the default is to stack the multiple bars (for the different years) on top of each other (as seen in the *Nature* example plot below).</span>
<span id="cb39-234"><a href="#cb39-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-235"><a href="#cb39-235" aria-hidden="true" tabindex="-1"></a><span class="fu">### (factor) level reordering</span></span>
<span id="cb39-236"><a href="#cb39-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-237"><a href="#cb39-237" aria-hidden="true" tabindex="-1"></a>It may seem irritating that countries are sorted alphabetically starting at the bottom. Moreover, 1952 is below 2007 in the plot (but not in the legend!). This is because these two columns are formatted as factors in our data and by default factor levels are sorted alphabetically.</span>
<span id="cb39-238"><a href="#cb39-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-239"><a href="#cb39-239" aria-hidden="true" tabindex="-1"></a>Note that ggplot applies this factor level order, but does it so from bottom to top.</span>
<span id="cb39-240"><a href="#cb39-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-241"><a href="#cb39-241" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-242"><a href="#cb39-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-243"><a href="#cb39-243" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-244"><a href="#cb39-244" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dat<span class="sc">$</span>country)</span>
<span id="cb39-245"><a href="#cb39-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-246"><a href="#cb39-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-247"><a href="#cb39-247" aria-hidden="true" tabindex="-1"></a>A useful package for dealing with factors in R is <span class="co">[</span><span class="ot">{forcats}</span><span class="co">](https://forcats.tidyverse.org/)</span> whose functions all start with <span class="in">`fct_*`</span>. One way of dealing with this is changing the factor level order in the data before passing it to ggplot. Here, we may simply reverse the order via <span class="in">`fct_rev()`</span>.</span>
<span id="cb39-248"><a href="#cb39-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-249"><a href="#cb39-249" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-250"><a href="#cb39-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-251"><a href="#cb39-251" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-252"><a href="#cb39-252" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb39-253"><a href="#cb39-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(country), <span class="sc">~</span> <span class="fu">fct_rev</span>(.x)))</span>
<span id="cb39-254"><a href="#cb39-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-255"><a href="#cb39-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-256"><a href="#cb39-256" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-257"><a href="#cb39-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-258"><a href="#cb39-258" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-259"><a href="#cb39-259" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dat<span class="sc">$</span>country)</span>
<span id="cb39-260"><a href="#cb39-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-261"><a href="#cb39-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-262"><a href="#cb39-262" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-263"><a href="#cb39-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-264"><a href="#cb39-264" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-265"><a href="#cb39-265" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb39-266"><a href="#cb39-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb39-267"><a href="#cb39-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>())</span>
<span id="cb39-268"><a href="#cb39-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-269"><a href="#cb39-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-270"><a href="#cb39-270" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-271"><a href="#cb39-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-272"><a href="#cb39-272" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-273"><a href="#cb39-273" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb39-274"><a href="#cb39-274" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Alternative 1</span></span>
<span id="cb39-275"><a href="#cb39-275" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb39-276"><a href="#cb39-276" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively, you may apply fct_rev() inside aes() instead of altering the data beforehand </span></span>
<span id="cb39-277"><a href="#cb39-277" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb39-278"><a href="#cb39-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> <span class="fu">fct_rev</span>(country), <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb39-279"><a href="#cb39-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>())</span>
<span id="cb39-280"><a href="#cb39-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-281"><a href="#cb39-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-282"><a href="#cb39-282" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-283"><a href="#cb39-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-284"><a href="#cb39-284" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-285"><a href="#cb39-285" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb39-286"><a href="#cb39-286" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Alternative 2</span></span>
<span id="cb39-287"><a href="#cb39-287" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb39-288"><a href="#cb39-288" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively, you may manually provide the levels in the desired order within scale_y_discrete()</span></span>
<span id="cb39-289"><a href="#cb39-289" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb39-290"><a href="#cb39-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb39-291"><a href="#cb39-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb39-292"><a href="#cb39-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;Zimbabwe&quot;</span>, <span class="st">&quot;Vietnam&quot;</span>, <span class="st">&quot;Nigeria&quot;</span>, <span class="st">&quot;Netherlands&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;Canada&quot;</span>))</span>
<span id="cb39-293"><a href="#cb39-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-294"><a href="#cb39-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-295"><a href="#cb39-295" aria-hidden="true" tabindex="-1"></a>However, it probably makes more sense to sort the countries according to the data. Here, we could sort them according to their life expectancy in 2007.</span>
<span id="cb39-296"><a href="#cb39-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-297"><a href="#cb39-297" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-298"><a href="#cb39-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-299"><a href="#cb39-299" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-300"><a href="#cb39-300" aria-hidden="true" tabindex="-1"></a>sorted_countries <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb39-301"><a href="#cb39-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">&quot;2007&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-302"><a href="#cb39-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lifeExp) <span class="sc">%&gt;%</span> </span>
<span id="cb39-303"><a href="#cb39-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb39-304"><a href="#cb39-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>()</span>
<span id="cb39-305"><a href="#cb39-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-306"><a href="#cb39-306" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb39-307"><a href="#cb39-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">fct_relevel</span>(country, sorted_countries))</span>
<span id="cb39-308"><a href="#cb39-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-309"><a href="#cb39-309" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb39-310"><a href="#cb39-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> year) <span class="sc">+</span></span>
<span id="cb39-311"><a href="#cb39-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>())</span>
<span id="cb39-312"><a href="#cb39-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-313"><a href="#cb39-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-314"><a href="#cb39-314" aria-hidden="true" tabindex="-1"></a>Next, we address the order of years in the plot and the legend. As you can see in the previous plots, once more the first factor level (1952) is on the bottom, while the second level (2007) is on top. Thus, we could use one of the approaches shown for <span class="in">`country`</span> to change that. More precisely, let&#39;s take the approach of *Alternative 1* and use <span class="in">`fct_rev()`</span> inside the <span class="in">`aes()`</span>.</span>
<span id="cb39-315"><a href="#cb39-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-316"><a href="#cb39-316" aria-hidden="true" tabindex="-1"></a>Note however, that while this changes the order of the years in the plot, it does not affect their order in the legend. To address that, we can use the <span class="in">`limits =`</span> argument in <span class="in">`scale_fill_manual()`</span> (which corresponds to *Alternative 2* above):</span>
<span id="cb39-317"><a href="#cb39-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-318"><a href="#cb39-318" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-319"><a href="#cb39-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-320"><a href="#cb39-320" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-321"><a href="#cb39-321" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb39-322"><a href="#cb39-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb39-323"><a href="#cb39-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb39-324"><a href="#cb39-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span>, <span class="st">&quot;2007&quot;</span>))</span>
<span id="cb39-325"><a href="#cb39-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-326"><a href="#cb39-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-327"><a href="#cb39-327" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-328"><a href="#cb39-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-329"><a href="#cb39-329" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-330"><a href="#cb39-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb39-331"><a href="#cb39-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Alternative</span></span>
<span id="cb39-332"><a href="#cb39-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb39-333"><a href="#cb39-333" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively, you may reverse the legend order via guides()</span></span>
<span id="cb39-334"><a href="#cb39-334" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb39-335"><a href="#cb39-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb39-336"><a href="#cb39-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb39-337"><a href="#cb39-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb39-338"><a href="#cb39-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-339"><a href="#cb39-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-340"><a href="#cb39-340" aria-hidden="true" tabindex="-1"></a><span class="fu">## reproducing a theme</span></span>
<span id="cb39-341"><a href="#cb39-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-342"><a href="#cb39-342" aria-hidden="true" tabindex="-1"></a>Now that we&#39;ve got the basics correct, the next thing I would want to change is things like the theme, i.e. the non-data components of the plot: titles, labels, fonts, background, gridlines, and legends.</span>
<span id="cb39-343"><a href="#cb39-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-344"><a href="#cb39-344" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`theme()`</span> allows us to format our plot in any way we want. Instead of picking things based on what feels good, let us here try to recreate the layout of a plot published in <span class="co">[</span><span class="ot">*Nature*</span><span class="co">](https://doi.org/10.1038/d41586-019-03305-w)</span> in &#39;150 years of Nature: a data graphic charts our evolution&#39; by Richard Monastersky &amp; Richard Van Noorden (2019). <span class="co">[</span><span class="ot">URL to the plot</span><span class="co">](https://media.nature.com/lw767/magazine-assets/d41586-019-03305-w/d41586-019-03305-w_17345518.png)</span>.</span>
<span id="cb39-345"><a href="#cb39-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-346"><a href="#cb39-346" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://media.nature.com/lw767/magazine-assets/d41586-019-03305-w/d41586-019-03305-w_17345518.png)</span></span>
<span id="cb39-347"><a href="#cb39-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-348"><a href="#cb39-348" aria-hidden="true" tabindex="-1"></a>Thus, a better starting point would be to use the <span class="co">[</span><span class="ot">complete theme</span><span class="co">](https://ggplot2.tidyverse.org/reference/ggtheme.html)</span> <span class="in">`theme_minimal()`</span> instead of the default <span class="in">`theme_gray()`</span>. From here, we can further adjust things via <span class="in">`theme()`</span>.</span>
<span id="cb39-349"><a href="#cb39-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-350"><a href="#cb39-350" aria-hidden="true" tabindex="-1"></a>Furthermore, let&#39;s also pick two of the colors used in that image (e.g. via any <span class="co">[</span><span class="ot">online color picker</span><span class="co">](https://google.gprivate.com/search.php?search?q=pick+color+from+image+online)</span>) for our years. We can create a named vector <span class="in">`year_colors`</span> and when changing <span class="in">`scale_fill_discrete()`</span> to <span class="in">`scale_fill_manual()`</span> supply it via the <span class="in">`values =`</span> argument.</span>
<span id="cb39-351"><a href="#cb39-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-352"><a href="#cb39-352" aria-hidden="true" tabindex="-1"></a>Finally, as our ggplot-code is getting longer, let&#39;s start saving out current plot into an object <span class="in">`p`</span> and reuse it.</span>
<span id="cb39-353"><a href="#cb39-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-354"><a href="#cb39-354" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-355"><a href="#cb39-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-356"><a href="#cb39-356" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-357"><a href="#cb39-357" aria-hidden="true" tabindex="-1"></a>year_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span> <span class="ot">=</span> <span class="st">&quot;#F7AA59&quot;</span>, <span class="st">&quot;2007&quot;</span> <span class="ot">=</span> <span class="st">&quot;#37A9E1&quot;</span>)</span>
<span id="cb39-358"><a href="#cb39-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-359"><a href="#cb39-359" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb39-360"><a href="#cb39-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">fill =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb39-361"><a href="#cb39-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb39-362"><a href="#cb39-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb39-363"><a href="#cb39-363" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb39-364"><a href="#cb39-364" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">names</span>(year_colors), </span>
<span id="cb39-365"><a href="#cb39-365" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> year_colors) <span class="sc">+</span></span>
<span id="cb39-366"><a href="#cb39-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb39-367"><a href="#cb39-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-368"><a href="#cb39-368" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb39-369"><a href="#cb39-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-370"><a href="#cb39-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-371"><a href="#cb39-371" aria-hidden="true" tabindex="-1"></a><span class="fu">### font</span></span>
<span id="cb39-372"><a href="#cb39-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-373"><a href="#cb39-373" aria-hidden="true" tabindex="-1"></a>To further replicate the aesthetics of the Nature plot, we introduce a custom font named *Kanit*. This font, available through <span class="co">[</span><span class="ot">Google Fonts</span><span class="co">](https://fonts.google.com/)</span>, has been chosen for its stylistic resemblance to the one used in the Nature publication.</span>
<span id="cb39-374"><a href="#cb39-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-375"><a href="#cb39-375" aria-hidden="true" tabindex="-1"></a>The process begins by fetching the font from Google Fonts and making it available for use in our R session via <span class="in">`sysfonts::font_add_google(&quot;Kanit&quot;, &quot;kanit&quot;)`</span>. Next, <span class="in">`showtext::showtext_auto()`</span> activates the use of custom fonts in plots. It&#39;s important to also run <span class="in">`showtext::showtext_opts(dpi = 300)`</span> to avoid getting unexpected results. This is because <span class="in">`{showtext}`</span> uses a default of 72 dpi, while e.g. exporting plots via <span class="in">`ggsave()`</span> defaults to <span class="in">`dpi = 300`</span>. Furthermore, you may also want the dpi to be 300 (or some other number) when rendering plots within your RMarkdown via <span class="in">`knitr::opts_chunk$set(dpi = 300)`</span> or quarto document via <span class="in">`fig-dpi: 300`</span>.</span>
<span id="cb39-376"><a href="#cb39-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-377"><a href="#cb39-377" aria-hidden="true" tabindex="-1"></a>We add a title and subtitle via <span class="in">`labs()`</span> and then apply the font to all text elements via <span class="in">`text = element_text(family = &quot;kanit&quot;)`</span>. For some reason, the default position of title and subtitle in a ggplot is left-aligned with the y-axis - to instead left-align it with the left side of the entire plot, we apply <span class="in">`plot.title.position = &quot;plot&quot;`</span>. Making the title a bit bigger and bold is straightforward. However, having a subtitle (or other text elements) that has automatic line breaks when the string is too long actually requires <span class="in">`{ggtext}`</span> and more specifically a <span class="in">`ggtext::element_textbox_simple()`</span> instead of the default <span class="in">`ggplot2::element_text()`</span>.</span>
<span id="cb39-378"><a href="#cb39-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-379"><a href="#cb39-379" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-380"><a href="#cb39-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-381"><a href="#cb39-381" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-382"><a href="#cb39-382" aria-hidden="true" tabindex="-1"></a>sysfonts<span class="sc">::</span><span class="fu">font_add_google</span>(<span class="st">&quot;Kanit&quot;</span>, <span class="st">&quot;kanit&quot;</span>)</span>
<span id="cb39-383"><a href="#cb39-383" aria-hidden="true" tabindex="-1"></a>showtext<span class="sc">::</span><span class="fu">showtext_auto</span>()</span>
<span id="cb39-384"><a href="#cb39-384" aria-hidden="true" tabindex="-1"></a><span class="co"># We already did this above, but dont forget about it:</span></span>
<span id="cb39-385"><a href="#cb39-385" aria-hidden="true" tabindex="-1"></a><span class="co"># showtext::showtext_opts(dpi = 300)</span></span>
<span id="cb39-386"><a href="#cb39-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-387"><a href="#cb39-387" aria-hidden="true" tabindex="-1"></a>long_subtitle <span class="ot">&lt;-</span> <span class="st">&quot;In the mid-twentieth century, global life expectancy was shaped by post-war recovery, with variations across countries. As decades progressed, public health advances and socioeconomic growth painted a new picture of longevity. The data now reflect a world where life expectancy in 2007 often mirrors an improved quality of life compared to 1952.&quot;</span></span>
<span id="cb39-388"><a href="#cb39-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-389"><a href="#cb39-389" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb39-390"><a href="#cb39-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-391"><a href="#cb39-391" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;LIFE EXPECTANCY&quot;</span>,</span>
<span id="cb39-392"><a href="#cb39-392" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> long_subtitle</span>
<span id="cb39-393"><a href="#cb39-393" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-394"><a href="#cb39-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;kanit&quot;</span>)) <span class="sc">+</span></span>
<span id="cb39-395"><a href="#cb39-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-396"><a href="#cb39-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb39-397"><a href="#cb39-397" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb39-398"><a href="#cb39-398" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> ggtext<span class="sc">::</span><span class="fu">element_textbox_simple</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">0</span>))</span>
<span id="cb39-399"><a href="#cb39-399" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-400"><a href="#cb39-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-401"><a href="#cb39-401" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb39-402"><a href="#cb39-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-403"><a href="#cb39-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-404"><a href="#cb39-404" aria-hidden="true" tabindex="-1"></a><span class="fu">### axes</span></span>
<span id="cb39-405"><a href="#cb39-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-406"><a href="#cb39-406" aria-hidden="true" tabindex="-1"></a>For our specific goal, we start by removing the axis titles as well as unnecessary space beyond the limits of each axis. Furthermore, there should be no axis line for the y-axis and a relatively thick black line with grey ticks for the x-axis. More details on axis formatting can be found <span class="co">[</span><span class="ot">here</span><span class="co">](https://schmidtpaul.github.io/dsfair_quarto/ch/summaryarticles/ggplot2intro.html#axes)</span>.</span>
<span id="cb39-407"><a href="#cb39-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-408"><a href="#cb39-408" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-409"><a href="#cb39-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-410"><a href="#cb39-410" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-411"><a href="#cb39-411" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb39-412"><a href="#cb39-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(</span>
<span id="cb39-413"><a href="#cb39-413" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>, <span class="co"># remove title</span></span>
<span id="cb39-414"><a href="#cb39-414" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>) <span class="co"># no extra space above or below</span></span>
<span id="cb39-415"><a href="#cb39-415" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb39-416"><a href="#cb39-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb39-417"><a href="#cb39-417" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>, <span class="co"># remove title</span></span>
<span id="cb39-418"><a href="#cb39-418" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)) <span class="co"># only 5% extra space above upper limit</span></span>
<span id="cb39-419"><a href="#cb39-419" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-420"><a href="#cb39-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-421"><a href="#cb39-421" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(), <span class="co"># remove line on y-axis</span></span>
<span id="cb39-422"><a href="#cb39-422" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>), <span class="co"># x-axis label color</span></span>
<span id="cb39-423"><a href="#cb39-423" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>), <span class="co"># x-axis tick color &amp; width</span></span>
<span id="cb39-424"><a href="#cb39-424" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.length.x =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>), <span class="co"># x-axis tick length</span></span>
<span id="cb39-425"><a href="#cb39-425" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="co"># x-axis line color &amp; width</span></span>
<span id="cb39-426"><a href="#cb39-426" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-427"><a href="#cb39-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-428"><a href="#cb39-428" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb39-429"><a href="#cb39-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-430"><a href="#cb39-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-431"><a href="#cb39-431" aria-hidden="true" tabindex="-1"></a><span class="fu">### legend</span></span>
<span id="cb39-432"><a href="#cb39-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-433"><a href="#cb39-433" aria-hidden="true" tabindex="-1"></a>Our legend is supposed to be above the plot and left-aligned. We partly achieve this via <span class="in">`legend.position`</span>, <span class="in">`legend.box.just`</span> and <span class="in">`legend.justification`</span>, but unfortunately this does not fully achieve the goal. We want to have a legend that is left-aligned with respect to the entire plot, not to the y-axis. As far as I know and unlike <span class="in">`plot.title.position = &quot;plot&quot;`</span> which we used above, there is no way of achieving this normally. Thus, we here use a hack by setting the left <span class="in">`margin()`</span> of the legend to a negative value that looks good enough.</span>
<span id="cb39-434"><a href="#cb39-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-435"><a href="#cb39-435" aria-hidden="true" tabindex="-1"></a>Besides the position, the legend title is made bold via <span class="in">`legend.title = element_text(face = &quot;bold&quot;)`</span> and we force all elements of the legend to be in one row via <span class="in">`guide_legend(title.position = &quot;left&quot;, nrow = 1)`</span>. Finally, the size of the colored squares in the legend is reduced via <span class="in">`legend.key.size = unit(0.4, &quot;cm&quot;)`</span>.</span>
<span id="cb39-436"><a href="#cb39-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-437"><a href="#cb39-437" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-438"><a href="#cb39-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-439"><a href="#cb39-439" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-440"><a href="#cb39-440" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb39-441"><a href="#cb39-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb39-442"><a href="#cb39-442" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb39-443"><a href="#cb39-443" aria-hidden="true" tabindex="-1"></a>      <span class="at">title.position =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb39-444"><a href="#cb39-444" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb39-445"><a href="#cb39-445" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-446"><a href="#cb39-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-447"><a href="#cb39-447" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb39-448"><a href="#cb39-448" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.just =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb39-449"><a href="#cb39-449" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.justification =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb39-450"><a href="#cb39-450" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">57</span>, <span class="at">unit =</span> <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb39-451"><a href="#cb39-451" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb39-452"><a href="#cb39-452" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb39-453"><a href="#cb39-453" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-454"><a href="#cb39-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-455"><a href="#cb39-455" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb39-456"><a href="#cb39-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-457"><a href="#cb39-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-458"><a href="#cb39-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### grid lines</span></span>
<span id="cb39-459"><a href="#cb39-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-460"><a href="#cb39-460" aria-hidden="true" tabindex="-1"></a>Lastly, we could adjust the grid lines. By default, ggplot has major and minor grid lines for both axes. Yet, we only want thin, dotted, grey lines for the major grid of the x-axis:</span>
<span id="cb39-461"><a href="#cb39-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-462"><a href="#cb39-462" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-463"><a href="#cb39-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-464"><a href="#cb39-464" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-465"><a href="#cb39-465" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb39-466"><a href="#cb39-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-467"><a href="#cb39-467" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-468"><a href="#cb39-468" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-469"><a href="#cb39-469" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>)</span>
<span id="cb39-470"><a href="#cb39-470" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-471"><a href="#cb39-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-472"><a href="#cb39-472" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb39-473"><a href="#cb39-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-474"><a href="#cb39-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-475"><a href="#cb39-475" aria-hidden="true" tabindex="-1"></a><span class="fu">## improve the plot</span></span>
<span id="cb39-476"><a href="#cb39-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-477"><a href="#cb39-477" aria-hidden="true" tabindex="-1"></a>We have now mostly reproduced the layout of the *Nature* plot and applied it to our plot. At this point, we could try out things that may improve the plot.</span>
<span id="cb39-478"><a href="#cb39-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-479"><a href="#cb39-479" aria-hidden="true" tabindex="-1"></a><span class="fu">### labels</span></span>
<span id="cb39-480"><a href="#cb39-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-481"><a href="#cb39-481" aria-hidden="true" tabindex="-1"></a>In certain cases it can be beneficial to additionally label data points. In this plot, we may simply label each bar with rounded life expectancy it represents. We here do so via <span class="in">`geom_text()`</span> where <span class="in">`aes(label = round(lifeExp))`</span>. Note that we also need to add <span class="in">`group = fct_rev(year)`</span> here. This is because so far we applied <span class="in">`fill = fct_rev(year)`</span> in the general <span class="in">`aes()`</span> which led to different groups due to the different fill colors so that <span class="in">`geom_col(position = position_dodge())`</span> knew which groups/bars were supposed to be dodged. However, our labels created via <span class="in">`geom_text()`</span> do not have a fill attribute but should still be dodged per year in the same way. Hence, <span class="in">`group = fct_rev(year)`</span> is required and moreover, <span class="in">`position_dodge(width = 0.9)`</span> actually needs a width value here set to the default dodge width for bars.</span>
<span id="cb39-482"><a href="#cb39-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-483"><a href="#cb39-483" aria-hidden="true" tabindex="-1"></a>Once this is out the way, we make the text white and right-align it with extra space via a value for <span class="in">`hjust`</span> that is larger than 1. Finally, don&#39;t forget to apply <span class="in">`family = &quot;kanit&quot;`</span> here as well, as geoms are not part of the <span class="in">`theme()`</span> and thus this <span class="in">`geom_text()`</span> knows nothing about Kanit.</span>
<span id="cb39-484"><a href="#cb39-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-485"><a href="#cb39-485" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-486"><a href="#cb39-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-487"><a href="#cb39-487" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-488"><a href="#cb39-488" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb39-489"><a href="#cb39-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-490"><a href="#cb39-490" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(lifeExp), <span class="at">group =</span> <span class="fu">fct_rev</span>(year)), </span>
<span id="cb39-491"><a href="#cb39-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb39-492"><a href="#cb39-492" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">1.1</span>,</span>
<span id="cb39-493"><a href="#cb39-493" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb39-494"><a href="#cb39-494" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb39-495"><a href="#cb39-495" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-496"><a href="#cb39-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-497"><a href="#cb39-497" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb39-498"><a href="#cb39-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-499"><a href="#cb39-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-500"><a href="#cb39-500" aria-hidden="true" tabindex="-1"></a><span class="fu">### remove legend</span></span>
<span id="cb39-501"><a href="#cb39-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-502"><a href="#cb39-502" aria-hidden="true" tabindex="-1"></a>This comes down to personal preferences, but we could remove the legend entirely by instead coloring the subtitle in a way that clarifies what the colors stand for. Here this means that 1952 should be orange and 2007 blue. This is once more made possible via {ggtext} as it allows to use HTML rendering for text in ggplot. This means e.g. that that writing <span class="in">`A &lt;b style=&#39;color:red;&#39;&gt; red &lt;/b&gt; word`</span> results in &quot;A <span class="kw">&lt;b</span> <span class="er">style</span><span class="ot">=</span><span class="st">&#39;color:red;&#39;</span><span class="kw">&gt;</span> red <span class="kw">&lt;/b&gt;</span> word&quot;. Let us therefore rewrite the subtitle accordingly:</span>
<span id="cb39-503"><a href="#cb39-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-504"><a href="#cb39-504" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-505"><a href="#cb39-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-506"><a href="#cb39-506" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-507"><a href="#cb39-507" aria-hidden="true" tabindex="-1"></a>new_long_subtitle <span class="ot">&lt;-</span> <span class="st">&quot;In the mid-twentieth century, global life expectancy was shaped by post-war recovery, with variations across countries. As decades progressed, public health advances and socioeconomic growth painted a new picture of longevity. The data now reflect a world where life expectancy in &lt;b style=&#39;color:#37A9E1;&#39;&gt;2007&lt;/b&gt; often mirrors an improved quality of life compared to &lt;b style=&#39;color:#F7AA59;&#39;&gt;1952&lt;/b&gt;.&quot;</span></span>
<span id="cb39-508"><a href="#cb39-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-509"><a href="#cb39-509" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb39-510"><a href="#cb39-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-511"><a href="#cb39-511" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;LIFE EXPECTANCY&quot;</span>,</span>
<span id="cb39-512"><a href="#cb39-512" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> new_long_subtitle</span>
<span id="cb39-513"><a href="#cb39-513" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-514"><a href="#cb39-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">&quot;none&quot;</span>) </span>
<span id="cb39-515"><a href="#cb39-515" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Be aware that we don&#39;t need to this here because we already</span></span>
<span id="cb39-516"><a href="#cb39-516" aria-hidden="true" tabindex="-1"></a>  <span class="co"># did so earlier to have automatic line breaks, but without</span></span>
<span id="cb39-517"><a href="#cb39-517" aria-hidden="true" tabindex="-1"></a>  <span class="co"># formatting the subtitle as a ggtext element, it would</span></span>
<span id="cb39-518"><a href="#cb39-518" aria-hidden="true" tabindex="-1"></a>  <span class="co"># not understand the html commnand:</span></span>
<span id="cb39-519"><a href="#cb39-519" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theme(plot.subtitle = ggtext::element_textbox_simple())</span></span>
<span id="cb39-520"><a href="#cb39-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-521"><a href="#cb39-521" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb39-522"><a href="#cb39-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-523"><a href="#cb39-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-524"><a href="#cb39-524" aria-hidden="true" tabindex="-1"></a><span class="fu">### dumbbell plot</span></span>
<span id="cb39-525"><a href="#cb39-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-526"><a href="#cb39-526" aria-hidden="true" tabindex="-1"></a>When it comes to visualizing changes or differences between two data points (like life expectancy across two different years in our case), dumbbell plots can offer a clearer and more direct comparison than grouped bar plots. While grouped bar plots efficiently display the individual values, dumbbell plots excel in highlighting the actual change or difference between these values. They connect the two data points with a line, making it visually immediate to see the extent of change. This is particularly beneficial in cases where the focus of the analysis is on the change itself rather than the absolute values. Moreover, dumbbell plots reduce clutter and can be easier to read when dealing with a large number of categories. By using different colors for the points and a subtle line to connect them, dumbbell plots provide a balanced emphasis on both the individual data points and their relative change, thereby offering a more nuanced view of the data. This makes them an excellent choice for our comparison of life expectancies over time.</span>
<span id="cb39-527"><a href="#cb39-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-528"><a href="#cb39-528" aria-hidden="true" tabindex="-1"></a>To create such a dumbbell plot, we need a transformed, wide version of our data (more on long/wide format <span class="co">[</span><span class="ot">here</span><span class="co">](https://schmidtpaul.github.io/dsfair_quarto/ch/rbasics/tidyverse.html#longwide-format)</span>):</span>
<span id="cb39-529"><a href="#cb39-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-530"><a href="#cb39-530" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-531"><a href="#cb39-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-532"><a href="#cb39-532" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-533"><a href="#cb39-533" aria-hidden="true" tabindex="-1"></a>dat_lifeExp_wide <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb39-534"><a href="#cb39-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, lifeExp) <span class="sc">%&gt;%</span> </span>
<span id="cb39-535"><a href="#cb39-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> lifeExp, <span class="at">names_prefix =</span> <span class="st">&#39;year_&#39;</span>)</span>
<span id="cb39-536"><a href="#cb39-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-537"><a href="#cb39-537" aria-hidden="true" tabindex="-1"></a>dat_lifeExp_wide</span>
<span id="cb39-538"><a href="#cb39-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-539"><a href="#cb39-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-540"><a href="#cb39-540" aria-hidden="true" tabindex="-1"></a>Furthermore, we need most of what we did so far again with our ggplot object <span class="in">`p`</span> again, but we do need to make some changes, which is why it makes sense to recreate <span class="in">`p2`</span> from scratch. All the theme elements will stay the same for now, so let&#39;s wrap them in our own custom theme:</span>
<span id="cb39-541"><a href="#cb39-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-542"><a href="#cb39-542" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-543"><a href="#cb39-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-544"><a href="#cb39-544" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-545"><a href="#cb39-545" aria-hidden="true" tabindex="-1"></a>theme_nature <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">base_size =</span> <span class="dv">12</span>) {</span>
<span id="cb39-546"><a href="#cb39-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> base_size) <span class="sc">+</span></span>
<span id="cb39-547"><a href="#cb39-547" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb39-548"><a href="#cb39-548" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;kanit&quot;</span>),</span>
<span id="cb39-549"><a href="#cb39-549" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb39-550"><a href="#cb39-550" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb39-551"><a href="#cb39-551" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> ggtext<span class="sc">::</span><span class="fu">element_textbox_simple</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">0</span>)),</span>
<span id="cb39-552"><a href="#cb39-552" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-553"><a href="#cb39-553" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>),</span>
<span id="cb39-554"><a href="#cb39-554" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb39-555"><a href="#cb39-555" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks.length.x =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb39-556"><a href="#cb39-556" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>),</span>
<span id="cb39-557"><a href="#cb39-557" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb39-558"><a href="#cb39-558" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.box.just =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb39-559"><a href="#cb39-559" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb39-560"><a href="#cb39-560" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,<span class="sc">-</span><span class="dv">57</span>, <span class="at">unit =</span> <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb39-561"><a href="#cb39-561" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb39-562"><a href="#cb39-562" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb39-563"><a href="#cb39-563" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-564"><a href="#cb39-564" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-565"><a href="#cb39-565" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(</span>
<span id="cb39-566"><a href="#cb39-566" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>,</span>
<span id="cb39-567"><a href="#cb39-567" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb39-568"><a href="#cb39-568" aria-hidden="true" tabindex="-1"></a>        <span class="at">linewidth =</span> <span class="fl">0.3</span></span>
<span id="cb39-569"><a href="#cb39-569" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb39-570"><a href="#cb39-570" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-571"><a href="#cb39-571" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-572"><a href="#cb39-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-573"><a href="#cb39-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-574"><a href="#cb39-574" aria-hidden="true" tabindex="-1"></a>Thus, when using our newly created <span class="in">`theme_nature()`</span>, we can focus on the changes in the other parts of our ggplot we made even before adding any new geoms:</span>
<span id="cb39-575"><a href="#cb39-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-576"><a href="#cb39-576" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>in the general <span class="in">`aes()`</span> we use <span class="in">`color = fct_rev(year)`</span> instead of <span class="in">`fill = fct_rev(year)`</span></span>
<span id="cb39-577"><a href="#cb39-577" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>accordingly, we also use <span class="in">`scale_color_manual()`</span> instead of <span class="in">`scale_fill_manual()`</span></span>
<span id="cb39-578"><a href="#cb39-578" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Above, we turned off the legend in a later step via <span class="in">`guides(fill = &quot;none&quot;)`</span>. This time, we immediately set <span class="in">`guide = &quot;none&quot;`</span> within <span class="in">`scale_color_manual()`</span>.</span>
<span id="cb39-579"><a href="#cb39-579" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>we actually do want extra space beyond the limits for both axes so we remove the <span class="in">`expand =`</span> statements</span>
<span id="cb39-580"><a href="#cb39-580" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>we no longer need bars created via <span class="in">`geom_col()`</span></span>
<span id="cb39-581"><a href="#cb39-581" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>we no longer the labels created via <span class="in">`geom_text()`</span></span>
<span id="cb39-582"><a href="#cb39-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-583"><a href="#cb39-583" aria-hidden="true" tabindex="-1"></a>Given this, we have a well-prepared ggplot in need of geoms:</span>
<span id="cb39-584"><a href="#cb39-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-585"><a href="#cb39-585" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-586"><a href="#cb39-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-587"><a href="#cb39-587" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-588"><a href="#cb39-588" aria-hidden="true" tabindex="-1"></a>p2_base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat) <span class="sc">+</span></span>
<span id="cb39-589"><a href="#cb39-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country, <span class="at">color =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb39-590"><a href="#cb39-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb39-591"><a href="#cb39-591" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb39-592"><a href="#cb39-592" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span>, <span class="st">&quot;2007&quot;</span>), </span>
<span id="cb39-593"><a href="#cb39-593" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> year_colors, </span>
<span id="cb39-594"><a href="#cb39-594" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb39-595"><a href="#cb39-595" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-596"><a href="#cb39-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(</span>
<span id="cb39-597"><a href="#cb39-597" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-598"><a href="#cb39-598" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb39-599"><a href="#cb39-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb39-600"><a href="#cb39-600" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-601"><a href="#cb39-601" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-602"><a href="#cb39-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-603"><a href="#cb39-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;LIFE EXPECTANCY&quot;</span>,</span>
<span id="cb39-604"><a href="#cb39-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> new_long_subtitle</span>
<span id="cb39-605"><a href="#cb39-605" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-606"><a href="#cb39-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_nature</span>()</span>
<span id="cb39-607"><a href="#cb39-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-608"><a href="#cb39-608" aria-hidden="true" tabindex="-1"></a>p2_base</span>
<span id="cb39-609"><a href="#cb39-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-610"><a href="#cb39-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-611"><a href="#cb39-611" aria-hidden="true" tabindex="-1"></a>We only need two geoms to create a dumbbell plot here: <span class="co">[</span><span class="ot">`geom_segment()`</span><span class="co">](https://ggplot2.tidyverse.org/reference/geom_segment.html)</span> draws a straight line between points (<span class="in">`x`</span>, <span class="in">`y`</span>) and (<span class="in">`xend`</span>, <span class="in">`yend`</span>), which works nicely with the <span class="in">`dat_lifeExp_wide`</span> created above. Note that the <span class="in">`color = &quot;#AAAAAA&quot;`</span> overrides the <span class="in">`color = fct_rev(year)`</span> from the general <span class="in">`aes()`</span> that would otherwise apply. The points are automatically created and colored via <span class="in">`geom_point()`</span> based on <span class="in">`dat`</span> and the general <span class="in">`aes()`</span>.</span>
<span id="cb39-612"><a href="#cb39-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-613"><a href="#cb39-613" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-614"><a href="#cb39-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-615"><a href="#cb39-615" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-616"><a href="#cb39-616" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p2_base <span class="sc">+</span></span>
<span id="cb39-617"><a href="#cb39-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb39-618"><a href="#cb39-618" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_lifeExp_wide,</span>
<span id="cb39-619"><a href="#cb39-619" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_1952, <span class="at">xend =</span> year_2007, <span class="at">y =</span> country, <span class="at">yend =</span> country),</span>
<span id="cb39-620"><a href="#cb39-620" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb39-621"><a href="#cb39-621" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb39-622"><a href="#cb39-622" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-623"><a href="#cb39-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>)</span>
<span id="cb39-624"><a href="#cb39-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-625"><a href="#cb39-625" aria-hidden="true" tabindex="-1"></a>p2</span>
<span id="cb39-626"><a href="#cb39-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-627"><a href="#cb39-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-628"><a href="#cb39-628" aria-hidden="true" tabindex="-1"></a><span class="fu">### labels again</span></span>
<span id="cb39-629"><a href="#cb39-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-630"><a href="#cb39-630" aria-hidden="true" tabindex="-1"></a>Once again we can decide additionally have data points labeled with their values. We can easily add the rounded life expectancy above each point by basically using the same general aesthetics as <span class="in">`geom_point()`</span> but vertically justifying a bit upwards.</span>
<span id="cb39-631"><a href="#cb39-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-632"><a href="#cb39-632" aria-hidden="true" tabindex="-1"></a>Yet, even more informative is the actual difference between 2007 and 1952. For that, we can use <span class="in">`dat_lifeExp_wide`</span> again where we already have one column per year and can subtract them into a new column <span class="in">`diff`</span>. For easier readability we then format that result by first rounding it and then making it into a string <span class="in">`diff_lab`</span> that always displays &quot;+&quot; or &quot;-&quot; in front of the respective number. I want to position this label on the right side of each dumbbell and could easily do so if the life expectancy were always higher for 2007 but this is not the case for Zimbabwe. Thus, I am also creating a helper column <span class="in">`max_x`</span> which is simply the maximum life expectancy of the two years or in other words the right side of the dumbbell. We now have everything we need to use a second <span class="in">`geom_text`</span> where we use <span class="in">`dat = dat_lifeExp_wide`</span> instead of the dataset provided in <span class="in">`ggplot(data = dat)`</span> and set the aesthetics as <span class="in">`aes(x = max_x, label = diff_lab)`</span>. So far, our labels would be on top of the point of the right side of the dumbbell. Thus, we add <span class="in">`position = position_nudge(x = 1)`</span> to nudge the position for the label one year to the right and additionally use <span class="in">`hjust = 0`</span> so that the label is not centered but instead left-aligned to that nudged position.</span>
<span id="cb39-633"><a href="#cb39-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-634"><a href="#cb39-634" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-635"><a href="#cb39-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-636"><a href="#cb39-636" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-637"><a href="#cb39-637" aria-hidden="true" tabindex="-1"></a>dat_lifeExp_wide <span class="ot">&lt;-</span> dat_lifeExp_wide <span class="sc">%&gt;%</span> </span>
<span id="cb39-638"><a href="#cb39-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-639"><a href="#cb39-639" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_x =</span> <span class="fu">pmax</span>(year_2007, year_1952),</span>
<span id="cb39-640"><a href="#cb39-640" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff =</span> year_2007 <span class="sc">-</span> year_1952,</span>
<span id="cb39-641"><a href="#cb39-641" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_lab =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%+d&quot;</span>, <span class="fu">round</span>(diff))</span>
<span id="cb39-642"><a href="#cb39-642" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-643"><a href="#cb39-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-644"><a href="#cb39-644" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p2 <span class="sc">+</span></span>
<span id="cb39-645"><a href="#cb39-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-646"><a href="#cb39-646" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(lifeExp)),</span>
<span id="cb39-647"><a href="#cb39-647" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb39-648"><a href="#cb39-648" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb39-649"><a href="#cb39-649" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb39-650"><a href="#cb39-650" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-651"><a href="#cb39-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-652"><a href="#cb39-652" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_lifeExp_wide,</span>
<span id="cb39-653"><a href="#cb39-653" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> max_x, <span class="at">label =</span> diff_lab),</span>
<span id="cb39-654"><a href="#cb39-654" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb39-655"><a href="#cb39-655" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb39-656"><a href="#cb39-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="dv">1</span>),</span>
<span id="cb39-657"><a href="#cb39-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb39-658"><a href="#cb39-658" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb39-659"><a href="#cb39-659" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-660"><a href="#cb39-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-661"><a href="#cb39-661" aria-hidden="true" tabindex="-1"></a>p2</span>
<span id="cb39-662"><a href="#cb39-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-663"><a href="#cb39-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-664"><a href="#cb39-664" aria-hidden="true" tabindex="-1"></a><span class="fu"># Part 3: Multiple plots</span></span>
<span id="cb39-665"><a href="#cb39-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-666"><a href="#cb39-666" aria-hidden="true" tabindex="-1"></a>Let us take a step back and look at our data again to realize that we also have information about population and GDP per capita for each country in each year:</span>
<span id="cb39-667"><a href="#cb39-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-668"><a href="#cb39-668" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-669"><a href="#cb39-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-670"><a href="#cb39-670" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-671"><a href="#cb39-671" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb39-672"><a href="#cb39-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-673"><a href="#cb39-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-674"><a href="#cb39-674" aria-hidden="true" tabindex="-1"></a>Thus, we could simply create the same ggplot three times: once for each variable. While this is certainly an option and call for packages such as <span class="co">[</span><span class="ot">{patchwork}</span><span class="co">](https://patchwork.data-imaginist.com/)</span> or <span class="co">[</span><span class="ot">{cowplot}</span><span class="co">](https://wilkelab.org/cowplot/index.html)</span>, we can also achieve our goal via facets within the same ggplot.</span>
<span id="cb39-675"><a href="#cb39-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-676"><a href="#cb39-676" aria-hidden="true" tabindex="-1"></a><span class="fu">## data prep</span></span>
<span id="cb39-677"><a href="#cb39-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-678"><a href="#cb39-678" aria-hidden="true" tabindex="-1"></a>To do that, we need to restructure our data so that all values are in the same column:</span>
<span id="cb39-679"><a href="#cb39-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-680"><a href="#cb39-680" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-681"><a href="#cb39-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-682"><a href="#cb39-682" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-683"><a href="#cb39-683" aria-hidden="true" tabindex="-1"></a>dat_long <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb39-684"><a href="#cb39-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb39-685"><a href="#cb39-685" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(lifeExp, pop, gdpPercap),</span>
<span id="cb39-686"><a href="#cb39-686" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;statistic&quot;</span>,</span>
<span id="cb39-687"><a href="#cb39-687" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb39-688"><a href="#cb39-688" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-689"><a href="#cb39-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-690"><a href="#cb39-690" aria-hidden="true" tabindex="-1"></a>dat_long</span>
<span id="cb39-691"><a href="#cb39-691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-692"><a href="#cb39-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-693"><a href="#cb39-693" aria-hidden="true" tabindex="-1"></a>Moreover, we need a <span class="in">`dat_all_wide`</span> instead of the <span class="in">`dat_lifeExp_wide`</span> from above:</span>
<span id="cb39-694"><a href="#cb39-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-695"><a href="#cb39-695" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-696"><a href="#cb39-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-697"><a href="#cb39-697" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-698"><a href="#cb39-698" aria-hidden="true" tabindex="-1"></a>dat_all_wide <span class="ot">&lt;-</span> dat_long <span class="sc">%&gt;%</span> </span>
<span id="cb39-699"><a href="#cb39-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> value, <span class="at">names_prefix =</span> <span class="st">&#39;year_&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-700"><a href="#cb39-700" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb39-701"><a href="#cb39-701" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_x =</span> <span class="fu">pmax</span>(year_2007, year_1952),</span>
<span id="cb39-702"><a href="#cb39-702" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff =</span> year_2007 <span class="sc">-</span> year_1952,</span>
<span id="cb39-703"><a href="#cb39-703" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_lab =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%+d&quot;</span>, <span class="fu">round</span>(diff))</span>
<span id="cb39-704"><a href="#cb39-704" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-705"><a href="#cb39-705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-706"><a href="#cb39-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-707"><a href="#cb39-707" aria-hidden="true" tabindex="-1"></a>Finally, besides changing title and subtitle, the most important change is to add <span class="in">`facet_wrap(facets = ~ statistic, scales = &quot;free_x&quot;)`</span> so that we get one plot per value in the <span class="in">`statistic`</span> column while their x-axes are allowed to have different scales:</span>
<span id="cb39-708"><a href="#cb39-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-709"><a href="#cb39-709" aria-hidden="true" tabindex="-1"></a><span class="fu">## facets</span></span>
<span id="cb39-710"><a href="#cb39-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-711"><a href="#cb39-711" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-712"><a href="#cb39-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-713"><a href="#cb39-713" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-714"><a href="#cb39-714" aria-hidden="true" tabindex="-1"></a>another_long_subtitle <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;In &lt;b style=&#39;color:&quot;</span>, year_colors[[<span class="st">&quot;2007&quot;</span>]], <span class="st">&quot;;&#39;&gt;2007&lt;/b&gt;, compared to &lt;b style=&#39;color:&quot;</span>, year_colors[[<span class="st">&quot;1952&quot;</span>]],<span class="st">&quot;;&#39;&gt;1952&lt;/b&gt;, life expectancy, Gross Domestic Product (GDP) per capita, and population data collectively reflect significant advancements in health, economic prosperity, and demographic trends, illustrating an overall enhanced quality of life.&quot;</span>)</span>
<span id="cb39-715"><a href="#cb39-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-716"><a href="#cb39-716" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat_long) <span class="sc">+</span></span>
<span id="cb39-717"><a href="#cb39-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> country, <span class="at">color =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb39-718"><a href="#cb39-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="sc">~</span> statistic, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-719"><a href="#cb39-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb39-720"><a href="#cb39-720" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb39-721"><a href="#cb39-721" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span>, <span class="st">&quot;2007&quot;</span>), </span>
<span id="cb39-722"><a href="#cb39-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> year_colors,</span>
<span id="cb39-723"><a href="#cb39-723" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb39-724"><a href="#cb39-724" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-725"><a href="#cb39-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-726"><a href="#cb39-726" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;GDP, LIFE EXPECTANCY &amp; POPULATION&quot;</span>,</span>
<span id="cb39-727"><a href="#cb39-727" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> another_long_subtitle</span>
<span id="cb39-728"><a href="#cb39-728" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-729"><a href="#cb39-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(</span>
<span id="cb39-730"><a href="#cb39-730" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-731"><a href="#cb39-731" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb39-732"><a href="#cb39-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb39-733"><a href="#cb39-733" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-734"><a href="#cb39-734" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-735"><a href="#cb39-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_nature</span>() <span class="sc">+</span></span>
<span id="cb39-736"><a href="#cb39-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb39-737"><a href="#cb39-737" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_all_wide,</span>
<span id="cb39-738"><a href="#cb39-738" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_1952, <span class="at">xend =</span> year_2007, <span class="at">y =</span> country, <span class="at">yend =</span> country),</span>
<span id="cb39-739"><a href="#cb39-739" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb39-740"><a href="#cb39-740" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb39-741"><a href="#cb39-741" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-742"><a href="#cb39-742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb39-743"><a href="#cb39-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-744"><a href="#cb39-744" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(value)),</span>
<span id="cb39-745"><a href="#cb39-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb39-746"><a href="#cb39-746" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb39-747"><a href="#cb39-747" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb39-748"><a href="#cb39-748" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-749"><a href="#cb39-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-750"><a href="#cb39-750" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_all_wide,</span>
<span id="cb39-751"><a href="#cb39-751" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> max_x, <span class="at">label =</span> diff_lab),</span>
<span id="cb39-752"><a href="#cb39-752" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb39-753"><a href="#cb39-753" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb39-754"><a href="#cb39-754" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="dv">1</span>),</span>
<span id="cb39-755"><a href="#cb39-755" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb39-756"><a href="#cb39-756" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb39-757"><a href="#cb39-757" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-758"><a href="#cb39-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-759"><a href="#cb39-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-760"><a href="#cb39-760" aria-hidden="true" tabindex="-1"></a><span class="fu">## individual labels</span></span>
<span id="cb39-761"><a href="#cb39-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-762"><a href="#cb39-762" aria-hidden="true" tabindex="-1"></a>So technically this worked, but it obviously needs some tweaking. First, the facets should have nicer labels than just the variable names. Moreover, while it is helpful that the x-axes of the different facets were allowed to have different scales/limits, the vast difference between magnitude of the three variables leads to problematic labels for both the axes and inside the plot. As a result, simply rounding the numbers is still appropriate for life expectancy, but not for the other two. We therefore create a new column <span class="in">`value_lab`</span> in which labels for each point are defined depending on what statistic it is. A convenient way to create such formatted numbers is the <span class="in">`scales::number()`</span> function. Besides <span class="in">`value_lab`</span> in <span class="in">`dat_long`</span>, we also recreate <span class="in">`diff_lab`</span> in <span class="in">`dat_all_wide`</span> this way, additionally adding the +/-. Finally note that also the method of positioning the label on the right side of the dumbbell no longer works. One way of fixing it is also creating a new column <span class="in">`x_pos_lab`</span> which adds a certain value to <span class="in">`max_x`</span> depending on the statistic.</span>
<span id="cb39-763"><a href="#cb39-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-764"><a href="#cb39-764" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-765"><a href="#cb39-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-766"><a href="#cb39-766" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-767"><a href="#cb39-767" aria-hidden="true" tabindex="-1"></a>dat_long <span class="ot">&lt;-</span> dat_long <span class="sc">%&gt;%</span> </span>
<span id="cb39-768"><a href="#cb39-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_lab =</span> <span class="fu">case_when</span>(</span>
<span id="cb39-769"><a href="#cb39-769" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;lifeExp&quot;</span>   <span class="sc">~</span> <span class="fu">number</span>(value, <span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb39-770"><a href="#cb39-770" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;pop&quot;</span>       <span class="sc">~</span> <span class="fu">number</span>(value, <span class="at">accuracy =</span> <span class="dv">1</span>,   <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000000</span>, <span class="at">suffix =</span> <span class="st">&quot;m&quot;</span>),</span>
<span id="cb39-771"><a href="#cb39-771" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;gdpPercap&quot;</span> <span class="sc">~</span> <span class="fu">number</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span>,    <span class="at">suffix =</span> <span class="st">&quot;k&quot;</span>)</span>
<span id="cb39-772"><a href="#cb39-772" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb39-773"><a href="#cb39-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-774"><a href="#cb39-774" aria-hidden="true" tabindex="-1"></a>dat_all_wide <span class="ot">&lt;-</span> dat_all_wide <span class="sc">%&gt;%</span></span>
<span id="cb39-775"><a href="#cb39-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-776"><a href="#cb39-776" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_lab =</span> <span class="fu">case_when</span>(</span>
<span id="cb39-777"><a href="#cb39-777" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;lifeExp&quot;</span>   <span class="sc">~</span> <span class="fu">number</span>(</span>
<span id="cb39-778"><a href="#cb39-778" aria-hidden="true" tabindex="-1"></a>        diff,</span>
<span id="cb39-779"><a href="#cb39-779" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_positive =</span> <span class="st">&quot;plus&quot;</span>,</span>
<span id="cb39-780"><a href="#cb39-780" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_negative =</span> <span class="st">&quot;minus&quot;</span>,</span>
<span id="cb39-781"><a href="#cb39-781" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="dv">1</span></span>
<span id="cb39-782"><a href="#cb39-782" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb39-783"><a href="#cb39-783" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;pop&quot;</span>       <span class="sc">~</span> <span class="fu">number</span>(</span>
<span id="cb39-784"><a href="#cb39-784" aria-hidden="true" tabindex="-1"></a>        diff,</span>
<span id="cb39-785"><a href="#cb39-785" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_positive =</span> <span class="st">&quot;plus&quot;</span>,</span>
<span id="cb39-786"><a href="#cb39-786" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_negative =</span> <span class="st">&quot;minus&quot;</span>,</span>
<span id="cb39-787"><a href="#cb39-787" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="dv">1</span>,</span>
<span id="cb39-788"><a href="#cb39-788" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb39-789"><a href="#cb39-789" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="st">&quot;m&quot;</span></span>
<span id="cb39-790"><a href="#cb39-790" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb39-791"><a href="#cb39-791" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;gdpPercap&quot;</span> <span class="sc">~</span> <span class="fu">number</span>(</span>
<span id="cb39-792"><a href="#cb39-792" aria-hidden="true" tabindex="-1"></a>        diff,</span>
<span id="cb39-793"><a href="#cb39-793" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_positive =</span> <span class="st">&quot;plus&quot;</span>,</span>
<span id="cb39-794"><a href="#cb39-794" aria-hidden="true" tabindex="-1"></a>        <span class="at">style_negative =</span> <span class="st">&quot;minus&quot;</span>,</span>
<span id="cb39-795"><a href="#cb39-795" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="fl">0.1</span>,</span>
<span id="cb39-796"><a href="#cb39-796" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb39-797"><a href="#cb39-797" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="st">&quot;k&quot;</span></span>
<span id="cb39-798"><a href="#cb39-798" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb39-799"><a href="#cb39-799" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb39-800"><a href="#cb39-800" aria-hidden="true" tabindex="-1"></a>    <span class="at">x_pos_lab =</span> <span class="fu">case_when</span>(</span>
<span id="cb39-801"><a href="#cb39-801" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;lifeExp&quot;</span>   <span class="sc">~</span> max_x <span class="sc">+</span> <span class="dv">3</span>,</span>
<span id="cb39-802"><a href="#cb39-802" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;pop&quot;</span>       <span class="sc">~</span> max_x <span class="sc">+</span> <span class="dv">10000000</span>,</span>
<span id="cb39-803"><a href="#cb39-803" aria-hidden="true" tabindex="-1"></a>      statistic <span class="sc">==</span> <span class="st">&quot;gdpPercap&quot;</span> <span class="sc">~</span> max_x <span class="sc">+</span> <span class="dv">3000</span></span>
<span id="cb39-804"><a href="#cb39-804" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-805"><a href="#cb39-805" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-806"><a href="#cb39-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-807"><a href="#cb39-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-808"><a href="#cb39-808" aria-hidden="true" tabindex="-1"></a>We can then apply these new labels to our faceted ggplot. We also provide labels per facet via <span class="in">`labeller = labeller(statistic = ...)`</span>. Finally note that even though we shortened the labels, they will still overlap in some cases where the points are too close to each other. One solution is to have the 1952-label below and the 2007-label above the point which can be achived by moving the <span class="in">`vjust`</span> inside the <span class="in">`aes()`</span> and having it depend on the year via <span class="in">`vjust = if_else(year == &quot;1952&quot;, 2, -1)`</span>:</span>
<span id="cb39-809"><a href="#cb39-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-810"><a href="#cb39-810" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-811"><a href="#cb39-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-812"><a href="#cb39-812" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-813"><a href="#cb39-813" aria-hidden="true" tabindex="-1"></a>facet_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">lifeExp =</span> <span class="st">&quot;Life Expectancy [years]&quot;</span>, <span class="at">pop =</span> <span class="st">&quot;Population&quot;</span>, <span class="at">gdpPercap =</span> <span class="st">&quot;GDP per Capita [$]&quot;</span>)</span>
<span id="cb39-814"><a href="#cb39-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-815"><a href="#cb39-815" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat_long) <span class="sc">+</span></span>
<span id="cb39-816"><a href="#cb39-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> country, <span class="at">color =</span> <span class="fu">fct_rev</span>(year)) <span class="sc">+</span></span>
<span id="cb39-817"><a href="#cb39-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb39-818"><a href="#cb39-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">facets =</span> <span class="sc">~</span> statistic,</span>
<span id="cb39-819"><a href="#cb39-819" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>,</span>
<span id="cb39-820"><a href="#cb39-820" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">statistic =</span> facet_labels)</span>
<span id="cb39-821"><a href="#cb39-821" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-822"><a href="#cb39-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb39-823"><a href="#cb39-823" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb39-824"><a href="#cb39-824" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;1952&quot;</span>, <span class="st">&quot;2007&quot;</span>), </span>
<span id="cb39-825"><a href="#cb39-825" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> year_colors,</span>
<span id="cb39-826"><a href="#cb39-826" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb39-827"><a href="#cb39-827" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-828"><a href="#cb39-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(</span>
<span id="cb39-829"><a href="#cb39-829" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-830"><a href="#cb39-830" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb39-831"><a href="#cb39-831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb39-832"><a href="#cb39-832" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-833"><a href="#cb39-833" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-834"><a href="#cb39-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-835"><a href="#cb39-835" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;GDP, LIFE EXPECTANCY &amp; POPULATION&quot;</span>,</span>
<span id="cb39-836"><a href="#cb39-836" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> another_long_subtitle</span>
<span id="cb39-837"><a href="#cb39-837" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-838"><a href="#cb39-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_nature</span>() <span class="sc">+</span></span>
<span id="cb39-839"><a href="#cb39-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-840"><a href="#cb39-840" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb39-841"><a href="#cb39-841" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb39-842"><a href="#cb39-842" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-843"><a href="#cb39-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb39-844"><a href="#cb39-844" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_all_wide,</span>
<span id="cb39-845"><a href="#cb39-845" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year_1952, <span class="at">xend =</span> year_2007, <span class="at">y =</span> country, <span class="at">yend =</span> country),</span>
<span id="cb39-846"><a href="#cb39-846" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb39-847"><a href="#cb39-847" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb39-848"><a href="#cb39-848" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-849"><a href="#cb39-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb39-850"><a href="#cb39-850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-851"><a href="#cb39-851" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">vjust =</span> <span class="fu">if_else</span>(year <span class="sc">==</span> <span class="st">&quot;1952&quot;</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb39-852"><a href="#cb39-852" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb39-853"><a href="#cb39-853" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb39-854"><a href="#cb39-854" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-855"><a href="#cb39-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb39-856"><a href="#cb39-856" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_all_wide,</span>
<span id="cb39-857"><a href="#cb39-857" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_pos_lab, <span class="at">label =</span> diff_lab),</span>
<span id="cb39-858"><a href="#cb39-858" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb39-859"><a href="#cb39-859" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb39-860"><a href="#cb39-860" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#AAAAAA&quot;</span>,</span>
<span id="cb39-861"><a href="#cb39-861" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;kanit&quot;</span></span>
<span id="cb39-862"><a href="#cb39-862" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-863"><a href="#cb39-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-864"><a href="#cb39-864" aria-hidden="true" tabindex="-1"></a>p3</span>
<span id="cb39-865"><a href="#cb39-865" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-866"><a href="#cb39-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-867"><a href="#cb39-867" aria-hidden="true" tabindex="-1"></a><span class="fu">## individual scales</span></span>
<span id="cb39-868"><a href="#cb39-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-869"><a href="#cb39-869" aria-hidden="true" tabindex="-1"></a>However, the axes are still not optimal for two reasons: The axis labels do not look good except for Life Expectancy and the labels inside the plots are sometimes cut off due to the axis limits. Adjusting axes per facet is actually not possible/straightforward via {ggplot2} so we need load <span class="co">[</span><span class="ot">{ggh4x}</span><span class="co">](https://teunbrand.github.io/ggh4x/index.html)</span> to make use of <span class="in">`facetted_pos_scales`</span>. Note that we can use <span class="in">`labels = scales::number_format()`</span> in basically the same way as we used <span class="in">`scales::number()`</span> above. Moreover, we choose good combinations of <span class="in">`limits`</span> and <span class="in">`expand`</span> to make sure no labels are cut off and finally pick <span class="in">`breaks`</span> via the convenient <span class="in">`scales::breaks_width()`</span> function:</span>
<span id="cb39-870"><a href="#cb39-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-871"><a href="#cb39-871" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb39-872"><a href="#cb39-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-873"><a href="#cb39-873" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb39-874"><a href="#cb39-874" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> p3 <span class="sc">+</span> <span class="fu">facetted_pos_scales</span>(</span>
<span id="cb39-875"><a href="#cb39-875" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">list</span>(</span>
<span id="cb39-876"><a href="#cb39-876" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;lifeExp&quot;</span> <span class="sc">~</span> <span class="fu">scale_x_continuous</span>(</span>
<span id="cb39-877"><a href="#cb39-877" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">90</span>),</span>
<span id="cb39-878"><a href="#cb39-878" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">breaks_width</span>(<span class="dv">20</span>),</span>
<span id="cb39-879"><a href="#cb39-879" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb39-880"><a href="#cb39-880" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb39-881"><a href="#cb39-881" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;pop&quot;</span> <span class="sc">~</span> <span class="fu">scale_x_continuous</span>(</span>
<span id="cb39-882"><a href="#cb39-882" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150000000</span>),</span>
<span id="cb39-883"><a href="#cb39-883" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.2</span>)),</span>
<span id="cb39-884"><a href="#cb39-884" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">breaks_width</span>(<span class="dv">50000000</span>),</span>
<span id="cb39-885"><a href="#cb39-885" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">number_format</span>(</span>
<span id="cb39-886"><a href="#cb39-886" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="dv">1</span>,</span>
<span id="cb39-887"><a href="#cb39-887" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb39-888"><a href="#cb39-888" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="st">&quot;m&quot;</span></span>
<span id="cb39-889"><a href="#cb39-889" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb39-890"><a href="#cb39-890" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb39-891"><a href="#cb39-891" aria-hidden="true" tabindex="-1"></a>    statistic <span class="sc">==</span> <span class="st">&quot;gdpPercap&quot;</span> <span class="sc">~</span> <span class="fu">scale_x_continuous</span>(</span>
<span id="cb39-892"><a href="#cb39-892" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50000</span>),</span>
<span id="cb39-893"><a href="#cb39-893" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.075</span>, <span class="fl">0.075</span>)),</span>
<span id="cb39-894"><a href="#cb39-894" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">breaks_width</span>(<span class="dv">25000</span>),</span>
<span id="cb39-895"><a href="#cb39-895" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">number_format</span>(</span>
<span id="cb39-896"><a href="#cb39-896" aria-hidden="true" tabindex="-1"></a>        <span class="at">accuracy =</span> <span class="dv">1</span>,</span>
<span id="cb39-897"><a href="#cb39-897" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb39-898"><a href="#cb39-898" aria-hidden="true" tabindex="-1"></a>        <span class="at">suffix =</span> <span class="st">&quot;k&quot;</span></span>
<span id="cb39-899"><a href="#cb39-899" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb39-900"><a href="#cb39-900" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-901"><a href="#cb39-901" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-902"><a href="#cb39-902" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="co"># apparently necessary?!</span></span>
<span id="cb39-903"><a href="#cb39-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-904"><a href="#cb39-904" aria-hidden="true" tabindex="-1"></a>p3</span>
<span id="cb39-905"><a href="#cb39-905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-906"><a href="#cb39-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-907"><a href="#cb39-907" aria-hidden="true" tabindex="-1"></a><span class="fu"># TODO</span></span>
<span id="cb39-908"><a href="#cb39-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-909"><a href="#cb39-909" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>After first plot: Talk about exporting and then about looking at your plot not in the RStudio preview window. Maybe even introduce {camcorder}</span>
<span id="cb39-910"><a href="#cb39-910" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Choosing colors / use viridis colors instead</span>
<span id="cb39-911"><a href="#cb39-911" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Have full code to get final each plot in a single folded chunk</span>
<span id="cb39-912"><a href="#cb39-912" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Packages in tutorial description but not in tutorial yet: cowplot, ggrepel, viridis</span>
<span id="cb39-913"><a href="#cb39-913" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>BioMath Logo/Link on Website</span>
<span id="cb39-914"><a href="#cb39-914" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>BioMath in Citation</span></code></pre></div>
</div>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 <p>All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
  </li>  
</ul>
    </div>
  </div>
</footer>

</body>

</html>